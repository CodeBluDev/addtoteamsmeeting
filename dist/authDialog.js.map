{"version":3,"file":"authDialog.js","mappings":"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","sources":["webpack://office-addin-taskpane-js/./src/dialogs/auth.js"],"sourcesContent":["/* global Office, msal */\n\nfunction sendMessage(type, payload) {\n  Office.context.ui.messageParent(JSON.stringify({ type, ...payload }));\n}\n\nfunction setStatus(message) {\n  const el = document.getElementById(\"authStatus\");\n  if (el) {\n    el.textContent = message;\n  }\n}\n\nfunction receiveConfig(message) {\n  try {\n    return JSON.parse(message);\n  } catch (error) {\n    return null;\n  }\n}\n\nOffice.onReady(() => {\n  setStatus(\"Auth dialog ready\");\n  // eslint-disable-next-line no-console\n  console.log(\"[AuthDialog] ready\");\n\n  Office.context.ui.addHandlerAsync(\n    Office.EventType.DialogParentMessageReceived,\n    async (arg) => {\n      const config = receiveConfig(arg.message);\n      if (!config || !config.clientId) {\n        setStatus(\"Missing auth config.\");\n        sendMessage(\"error\", { message: \"Missing auth configuration.\" });\n        return;\n      }\n\n      setStatus(\"Starting sign-inâ€¦\");\n      const msalConfig = {\n        auth: {\n          clientId: config.clientId,\n          authority: config.authority || \"https://login.microsoftonline.com/organizations\",\n          redirectUri: window.location.origin + window.location.pathname\n        },\n        cache: {\n          cacheLocation: \"sessionStorage\"\n        }\n      };\n\n      const app = new msal.PublicClientApplication(msalConfig);\n      const scopes = config.scopes || [\"https://graph.microsoft.com/Calendars.ReadWrite\"];\n\n      try {\n        const loginResult = await app.loginPopup({ scopes });\n        const account = loginResult.account;\n        const tokenResult = await app.acquireTokenSilent({\n          scopes,\n          account\n        });\n        setStatus(\"Token acquired.\");\n        sendMessage(\"token\", { accessToken: tokenResult.accessToken });\n      } catch (error) {\n        setStatus(`Auth error: ${error.message || \"login failed\"}`);\n        try {\n          const fallback = await app.acquireTokenPopup({ scopes });\n          setStatus(\"Token acquired.\");\n          sendMessage(\"token\", { accessToken: fallback.accessToken });\n        } catch (popupError) {\n          setStatus(`Auth error: ${popupError.message || \"login failed\"}`);\n          sendMessage(\"error\", { message: popupError.message || \"Auth failed.\" });\n        }\n      }\n    }\n  );\n});\n"],"names":["e","t","r","Symbol","n","iterator","o","toStringTag","i","c","prototype","Generator","u","Object","create","_regeneratorDefine2","f","p","y","G","v","a","d","bind","length","l","TypeError","call","done","value","return","GeneratorFunction","GeneratorFunctionPrototype","getPrototypeOf","setPrototypeOf","__proto__","displayName","_regenerator","w","m","defineProperty","_invoke","enumerable","configurable","writable","asyncGeneratorStep","Promise","resolve","then","ownKeys","keys","getOwnPropertySymbols","filter","getOwnPropertyDescriptor","push","apply","_defineProperty","_typeof","toPrimitive","String","_toPrimitive","_toPropertyKey","sendMessage","type","payload","Office","context","ui","messageParent","JSON","stringify","arguments","forEach","getOwnPropertyDescriptors","defineProperties","_objectSpread","setStatus","message","el","document","getElementById","textContent","receiveConfig","parse","error","onReady","console","log","addHandlerAsync","EventType","DialogParentMessageReceived","_ref","_callee","arg","config","msalConfig","app","scopes","loginResult","account","tokenResult","fallback","_t","_t2","_context","clientId","auth","authority","redirectUri","window","location","origin","pathname","cache","cacheLocation","msal","PublicClientApplication","loginPopup","acquireTokenSilent","accessToken","concat","acquireTokenPopup","_next","_throw","_x"],"ignoreList":[],"sourceRoot":""}