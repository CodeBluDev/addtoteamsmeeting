{"version":3,"file":"commands.js","mappings":"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","sources":["webpack://office-addin-taskpane-js/./src/commands/commands.js"],"sourcesContent":["/*\n * Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.\n * See LICENSE in the project root for license information.\n */\n\n/* global Office, OfficeRuntime */\n\nOffice.onReady(() => {\n  // If needed, Office.js is ready to be called.\n});\n\nconst BUILD_TAG = \"v1.8.2\";\nconst BUILD_MARKER = \"2024-09-18T16:40Z\";\nconst EWS_MESSAGES_NS = \"http://schemas.microsoft.com/exchange/services/2006/messages\";\nconst EWS_TYPES_NS = \"http://schemas.microsoft.com/exchange/services/2006/types\";\nconst DEBUG_LOGS = true;\nconst NOTIFICATION_ICON_ID = \"Icon.16x16\";\nconst DIALOG_URL = \"https://codebludev.github.io/addtoteamsmeeting/create-event.html?v=1.8.2\";\nconst GRAPH_BASE_URL = \"https://graph.microsoft.com/v1.0\";\nconst GRAPH_SEARCH_DAYS = 90;\nconst AAD_CLIENT_ID = \"226fcb0c-fa77-48bb-a20e-70a75ce176fd\";\nconst AAD_AUTHORITY = \"https://login.microsoftonline.com/organizations\";\nconst GRAPH_SCOPES = [\"https://graph.microsoft.com/Calendars.ReadWrite\"];\nconst AUTH_DIALOG_URL = \"https://codebludev.github.io/addtoteamsmeeting/auth.html?v=1.8.2\";\nlet cachedGraphToken = null;\nlet cachedGraphTokenExpiresAt = 0;\n\n/**\n * Shows a notification when the add-in command is executed.\n * @param event {Office.AddinCommands.Event}\n */\nfunction addTeamsLinkToLocation(event) {\n  const item = Office.context.mailbox.item;\n  logDebug(\"Command invoked\", { itemId: item.itemId, itemType: item.itemType });\n\n  // Read the message body as HTML\n  item.body.getAsync(Office.CoercionType.Html, (bodyResult) => {\n    logDebug(\"Body getAsync result\", { status: bodyResult.status });\n    if (bodyResult.status !== Office.AsyncResultStatus.Succeeded) {\n      item.notificationMessages.replaceAsync(\"error\", {\n        type: Office.MailboxEnums.ItemNotificationMessageType.ErrorMessage,\n        message: \"Unable to read message body.\"\n      });\n      event.completed();\n      return;\n    }\n\n    const bodyHtml = bodyResult.value;\n\n    // Extract the Teams meeting link\n    const teamsLink = extractTeamsLink(bodyHtml);\n    logDebug(\"Teams link match\", { found: Boolean(teamsLink) });\n\n    if (!teamsLink) {\n      notifyInfo(item, \"No Microsoft Teams meeting link found in this invite.\");\n      event.completed();\n      return;\n    }\n\n    logDebug(\"Teams link extracted\", { teamsLink });\n    const meetingId = extractMeetingId(bodyHtml, teamsLink);\n    logDebug(\"Meeting id extracted\", { meetingId });\n\n    findCalendarEventByGraph(teamsLink, meetingId)\n      .then((eventId) => {\n        if (!eventId) {\n          notifyInfo(item, \"No matching calendar event found. Opening event dialog.\");\n          openCreateEventDialog(item, teamsLink);\n          event.completed();\n          return null;\n        }\n\n        return updateCalendarEventLocationGraph(eventId, teamsLink)\n          .then(() => {\n            notifySuccess(item);\n            event.completed();\n            return null;\n          })\n          .catch((updateError) => {\n            logDebug(\"Graph update failed\", { message: updateError.message });\n            notifyError(item, \"Unable to update the calendar location.\");\n            event.completed();\n            return null;\n          });\n      })\n      .catch((error) => {\n        logDebug(\"Graph search failed\", { message: error.message });\n        notifyInfo(item, \"Opening event dialog (calendar search blocked).\");\n        openCreateEventDialog(item, teamsLink);\n        event.completed();\n      });\n  });\n}\n\nfunction notifySuccess(item) {\n  item.notificationMessages.replaceAsync(\"success\", {\n    type: Office.MailboxEnums.ItemNotificationMessageType.InformationalMessage,\n    icon: NOTIFICATION_ICON_ID,\n    persistent: false,\n    message: `Teams meeting link added to Location. (${BUILD_TAG} | ${BUILD_MARKER})`\n  });\n}\n\nfunction notifyError(item, message) {\n  item.notificationMessages.replaceAsync(\"error\", {\n    type: Office.MailboxEnums.ItemNotificationMessageType.ErrorMessage,\n    message\n  });\n}\n\nfunction notifyInfo(item, message) {\n  item.notificationMessages.replaceAsync(\"info\", {\n    type: Office.MailboxEnums.ItemNotificationMessageType.InformationalMessage,\n    icon: NOTIFICATION_ICON_ID,\n    persistent: false,\n    message\n  });\n}\n\nfunction openCreateEventDialog(item, teamsLink) {\n  const subject = item.subject || \"Teams meeting\";\n\n  Office.context.ui.displayDialogAsync(\n    DIALOG_URL,\n    { height: 55, width: 35, displayInIframe: true },\n    (result) => {\n      if (result.status !== Office.AsyncResultStatus.Succeeded) {\n        notifyError(item, \"Unable to open the event dialog.\");\n        return;\n      }\n\n      const dialog = result.value;\n      dialog.addEventHandler(Office.EventType.DialogMessageReceived, (arg) => {\n        let data;\n        try {\n          data = JSON.parse(arg.message);\n        } catch (parseError) {\n          notifyError(item, \"Invalid response from dialog.\");\n          dialog.close();\n          return;\n        }\n\n        if (data.action === \"cancel\") {\n          dialog.close();\n          return;\n        }\n\n        if (data.action !== \"create\") {\n          notifyError(item, \"Unknown dialog response.\");\n          dialog.close();\n          return;\n        }\n\n        const start = new Date(data.start);\n        const end = new Date(data.end);\n        if (Number.isNaN(start.valueOf()) || Number.isNaN(end.valueOf())) {\n          notifyError(item, \"Invalid date/time from dialog.\");\n          dialog.close();\n          return;\n        }\n\n        Office.context.mailbox.displayNewAppointmentForm({\n          subject: data.subject || subject,\n          location: teamsLink,\n          start,\n          end\n        });\n\n        dialog.close();\n        notifySuccess(item);\n      });\n\n      dialog.addEventHandler(Office.EventType.DialogEventReceived, () => {\n        notifyInfo(item, \"Event dialog closed.\");\n      });\n\n      dialog.messageChild(\n        JSON.stringify({\n          subject,\n          teamsLink\n        })\n      );\n    }\n  );\n}\n\nfunction getMessageTimeRange(item, callback) {\n  if (!item.start || !item.end || !item.start.getAsync || !item.end.getAsync) {\n    callback(null, null);\n    return;\n  }\n\n  item.start.getAsync((startResult) => {\n    if (startResult.status !== Office.AsyncResultStatus.Succeeded) {\n      callback(startResult.error, null);\n      return;\n    }\n\n    item.end.getAsync((endResult) => {\n      if (endResult.status !== Office.AsyncResultStatus.Succeeded) {\n        callback(endResult.error, null);\n        return;\n      }\n\n      const start = new Date(startResult.value);\n      const end = new Date(endResult.value);\n      if (Number.isNaN(start.valueOf()) || Number.isNaN(end.valueOf())) {\n        callback(null, null);\n        return;\n      }\n\n      callback(null, { start, end });\n    });\n  });\n}\n\nfunction findCalendarItemByTeamsLink(teamsLink, callback) {\n  const escapedLink = escapeXml(teamsLink);\n  logDebug(\"EWS FindItem by link request prepared\");\n  const request = `<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<soap:Envelope xmlns:soap=\"http://schemas.xmlsoap.org/soap/envelope/\"\n               xmlns:t=\"${EWS_TYPES_NS}\"\n               xmlns:m=\"${EWS_MESSAGES_NS}\">\n  <soap:Header>\n    <t:RequestServerVersion Version=\"Exchange2013\" />\n  </soap:Header>\n  <soap:Body>\n    <m:FindItem Traversal=\"Shallow\">\n      <m:ItemShape>\n        <t:BaseShape>IdOnly</t:BaseShape>\n      </m:ItemShape>\n      <m:Restriction>\n        <t:Contains ContainmentMode=\"Substring\" ContainmentComparison=\"IgnoreCase\">\n          <t:FieldURI FieldURI=\"item:Body\" />\n          <t:Constant Value=\"${escapedLink}\" />\n        </t:Contains>\n      </m:Restriction>\n      <m:ParentFolderIds>\n        <t:DistinguishedFolderId Id=\"calendar\" />\n      </m:ParentFolderIds>\n    </m:FindItem>\n  </soap:Body>\n</soap:Envelope>`;\n\n  Office.context.mailbox.makeEwsRequestAsync(request, (result) => {\n    logDebug(\"EWS FindItem by link response\", {\n      status: result.status,\n      error: result.error ? { name: result.error.name, message: result.error.message } : null\n    });\n    if (result.status !== Office.AsyncResultStatus.Succeeded) {\n      callback(result.error, null);\n      return;\n    }\n\n    const calendarItem = parseFirstCalendarItem(result.value);\n    callback(null, calendarItem);\n  });\n}\n\nfunction findCalendarItemByTimeRange(timeRange, callback) {\n  const startIso = timeRange.start.toISOString();\n  const endIso = timeRange.end.toISOString();\n  logDebug(\"EWS FindItem by time request prepared\", { startIso, endIso });\n  const request = `<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<soap:Envelope xmlns:soap=\"http://schemas.xmlsoap.org/soap/envelope/\"\n               xmlns:t=\"${EWS_TYPES_NS}\"\n               xmlns:m=\"${EWS_MESSAGES_NS}\">\n  <soap:Header>\n    <t:RequestServerVersion Version=\"Exchange2013\" />\n  </soap:Header>\n  <soap:Body>\n    <m:FindItem Traversal=\"Shallow\">\n      <m:ItemShape>\n        <t:BaseShape>IdOnly</t:BaseShape>\n        <t:AdditionalProperties>\n          <t:FieldURI FieldURI=\"calendar:Start\" />\n          <t:FieldURI FieldURI=\"calendar:End\" />\n        </t:AdditionalProperties>\n      </m:ItemShape>\n      <m:CalendarView StartDate=\"${startIso}\" EndDate=\"${endIso}\" />\n      <m:ParentFolderIds>\n        <t:DistinguishedFolderId Id=\"calendar\" />\n      </m:ParentFolderIds>\n    </m:FindItem>\n  </soap:Body>\n</soap:Envelope>`;\n\n  Office.context.mailbox.makeEwsRequestAsync(request, (result) => {\n    logDebug(\"EWS FindItem by time response\", {\n      status: result.status,\n      error: result.error ? { name: result.error.name, message: result.error.message } : null\n    });\n    if (result.status !== Office.AsyncResultStatus.Succeeded) {\n      callback(result.error, null);\n      return;\n    }\n\n    const calendarItem = parseCalendarItemByTime(result.value, timeRange);\n    callback(null, calendarItem);\n  });\n}\n\nfunction updateCalendarItemLocation(calendarItem, location, callback) {\n  const escapedLocation = escapeXml(location);\n  logDebug(\"EWS UpdateItem request prepared\", { itemId: calendarItem.id });\n  const request = `<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<soap:Envelope xmlns:soap=\"http://schemas.xmlsoap.org/soap/envelope/\"\n               xmlns:t=\"${EWS_TYPES_NS}\"\n               xmlns:m=\"${EWS_MESSAGES_NS}\">\n  <soap:Header>\n    <t:RequestServerVersion Version=\"Exchange2013\" />\n  </soap:Header>\n  <soap:Body>\n    <m:UpdateItem ConflictResolution=\"AlwaysOverwrite\" SendMeetingInvitationsOrCancellations=\"SendToNone\">\n      <m:ItemChanges>\n        <t:ItemChange>\n          <t:ItemId Id=\"${calendarItem.id}\" ChangeKey=\"${calendarItem.changeKey}\" />\n          <t:Updates>\n            <t:SetItemField>\n              <t:FieldURI FieldURI=\"calendar:Location\" />\n              <t:CalendarItem>\n                <t:Location>${escapedLocation}</t:Location>\n              </t:CalendarItem>\n            </t:SetItemField>\n          </t:Updates>\n        </t:ItemChange>\n      </m:ItemChanges>\n    </m:UpdateItem>\n  </soap:Body>\n</soap:Envelope>`;\n\n  Office.context.mailbox.makeEwsRequestAsync(request, (result) => {\n    logDebug(\"EWS UpdateItem response\", {\n      status: result.status,\n      error: result.error ? { name: result.error.name, message: result.error.message } : null\n    });\n    if (result.status !== Office.AsyncResultStatus.Succeeded) {\n      callback(result.error);\n      return;\n    }\n\n    const xmlDoc = parseXml(result.value);\n    if (!xmlDoc || !isEwsResponseSuccess(xmlDoc)) {\n      callback(new Error(\"EWS UpdateItem failed.\"));\n      return;\n    }\n\n    callback(null);\n  });\n}\n\nfunction parseFirstCalendarItem(responseText) {\n  const xmlDoc = parseXml(responseText);\n  if (!xmlDoc) {\n    return null;\n  }\n\n  const itemId = xmlDoc.getElementsByTagNameNS(EWS_TYPES_NS, \"ItemId\")[0];\n  if (!itemId) {\n    return null;\n  }\n\n  return {\n    id: itemId.getAttribute(\"Id\"),\n    changeKey: itemId.getAttribute(\"ChangeKey\")\n  };\n}\n\nfunction parseCalendarItemByTime(responseText, timeRange) {\n  const xmlDoc = parseXml(responseText);\n  if (!xmlDoc) {\n    return null;\n  }\n\n  const calendarItems = xmlDoc.getElementsByTagNameNS(EWS_TYPES_NS, \"CalendarItem\");\n  for (let i = 0; i < calendarItems.length; i += 1) {\n    const calendarItem = calendarItems[i];\n    const startNode = calendarItem.getElementsByTagNameNS(EWS_TYPES_NS, \"Start\")[0];\n    const endNode = calendarItem.getElementsByTagNameNS(EWS_TYPES_NS, \"End\")[0];\n    const itemId = calendarItem.getElementsByTagNameNS(EWS_TYPES_NS, \"ItemId\")[0];\n\n    if (!startNode || !endNode || !itemId) {\n      continue;\n    }\n\n    const start = new Date(startNode.textContent);\n    const end = new Date(endNode.textContent);\n    if (Number.isNaN(start.valueOf()) || Number.isNaN(end.valueOf())) {\n      continue;\n    }\n\n    if (isSameTimeRange(start, end, timeRange)) {\n      return {\n        id: itemId.getAttribute(\"Id\"),\n        changeKey: itemId.getAttribute(\"ChangeKey\")\n      };\n    }\n  }\n\n  return null;\n}\n\nfunction isSameTimeRange(start, end, timeRange) {\n  const toleranceMs = 60000;\n  return (\n    Math.abs(start - timeRange.start) <= toleranceMs &&\n    Math.abs(end - timeRange.end) <= toleranceMs\n  );\n}\n\nfunction parseXml(xmlString) {\n  if (!xmlString) {\n    return null;\n  }\n\n  return new DOMParser().parseFromString(xmlString, \"text/xml\");\n}\n\nfunction isEwsResponseSuccess(xmlDoc) {\n  const responseCode = xmlDoc.getElementsByTagNameNS(EWS_MESSAGES_NS, \"ResponseCode\")[0];\n  return responseCode && responseCode.textContent === \"NoError\";\n}\n\nfunction escapeXml(value) {\n  return String(value)\n    .replace(/&/g, \"&amp;\")\n    .replace(/</g, \"&lt;\")\n    .replace(/>/g, \"&gt;\")\n    .replace(/\"/g, \"&quot;\")\n    .replace(/'/g, \"&apos;\");\n}\n\nfunction extractMeetingId(bodyHtml, teamsLink) {\n  if (teamsLink) {\n    const linkMatch = teamsLink.match(/19:meeting_[^/?\"'\\\\s<>]+/i);\n    if (linkMatch) {\n      return linkMatch[0];\n    }\n  }\n\n  const combined = `${bodyHtml} ${teamsLink || \"\"}`;\n  const decoded = decodeHtmlEntities(decodeLink(combined));\n  const match = decoded.match(/19:meeting_[^/?\"'\\\\s<>]+/i);\n  if (match) {\n    return match[0];\n  }\n\n  const encodedMatch = combined.match(/19%3Ameeting_[^\"'\\\\s<>%]+/i);\n  if (encodedMatch) {\n    return decodeLink(encodedMatch[0]);\n  }\n\n  return null;\n}\n\nasync function findCalendarEventByGraph(teamsLink, meetingId) {\n  const token = await getGraphAccessToken();\n  const start = new Date();\n  const end = new Date(start.getTime() + GRAPH_SEARCH_DAYS * 24 * 60 * 60 * 1000);\n  let url = `${GRAPH_BASE_URL}/me/calendarView?startDateTime=${encodeURIComponent(\n    start.toISOString()\n  )}&endDateTime=${encodeURIComponent(end.toISOString())}` +\n    \"&$select=id,subject,body,location,onlineMeetingUrl,start,end\";\n\n  while (url) {\n    const response = await fetch(url, {\n      headers: {\n        Authorization: `Bearer ${token}`,\n        Prefer: 'outlook.body-content-type=\"text\"'\n      }\n    });\n\n    if (!response.ok) {\n      const text = await response.text();\n      throw new Error(`Graph calendarView failed: ${response.status} ${text}`);\n    }\n\n    const data = await response.json();\n    const items = data.value || [];\n\n    for (let i = 0; i < items.length; i += 1) {\n      if (eventMatchesTeams(items[i], teamsLink, meetingId)) {\n        return items[i].id;\n      }\n    }\n\n    url = data[\"@odata.nextLink\"] || null;\n  }\n\n  return null;\n}\n\nasync function updateCalendarEventLocationGraph(eventId, teamsLink) {\n  const token = await getGraphAccessToken();\n  const response = await fetch(`${GRAPH_BASE_URL}/me/events/${eventId}`, {\n    method: \"PATCH\",\n    headers: {\n      Authorization: `Bearer ${token}`,\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify({\n      location: {\n        displayName: teamsLink\n      }\n    })\n  });\n\n  if (!response.ok) {\n    const text = await response.text();\n    throw new Error(`Graph update failed: ${response.status} ${text}`);\n  }\n}\n\nasync function getGraphAccessToken() {\n  if (cachedGraphToken && Date.now() < cachedGraphTokenExpiresAt) {\n    return cachedGraphToken;\n  }\n\n  if (OfficeRuntime && OfficeRuntime.auth && OfficeRuntime.auth.getAccessToken) {\n    try {\n      const token = await OfficeRuntime.auth.getAccessToken({\n        allowSignInPrompt: true,\n        allowConsentPrompt: true,\n        forMSGraphAccess: true\n      });\n      logDebug(\"Graph token acquired (OfficeRuntime)\");\n      cacheGraphToken(token, 50);\n      return token;\n    } catch (error) {\n      logDebug(\"OfficeRuntime auth failed\", { message: error.message });\n    }\n  }\n\n  const token = await getGraphAccessTokenViaDialog();\n  logDebug(\"Graph token acquired (dialog)\");\n  cacheGraphToken(token, 45);\n  return token;\n}\n\nfunction eventMatchesTeams(event, teamsLink, meetingId) {\n  const bodyText = event.body && event.body.content ? event.body.content : \"\";\n  const onlineUrl = event.onlineMeetingUrl || \"\";\n\n  if (meetingId) {\n    if (bodyText.includes(meetingId) || onlineUrl.includes(meetingId)) {\n      return true;\n    }\n  }\n\n  if (teamsLink) {\n    if (bodyText.includes(teamsLink) || onlineUrl.includes(teamsLink)) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nfunction cacheGraphToken(token, minutes) {\n  cachedGraphToken = token;\n  cachedGraphTokenExpiresAt = Date.now() + minutes * 60 * 1000;\n}\n\nfunction getGraphAccessTokenViaDialog() {\n  return new Promise((resolve, reject) => {\n    Office.context.ui.displayDialogAsync(\n      AUTH_DIALOG_URL,\n      { height: 60, width: 40, displayInIframe: true },\n      (result) => {\n        if (result.status !== Office.AsyncResultStatus.Succeeded) {\n          reject(new Error(\"Unable to open auth dialog.\"));\n          return;\n        }\n\n        const dialog = result.value;\n        dialog.addEventHandler(Office.EventType.DialogMessageReceived, (arg) => {\n          let data;\n          try {\n            data = JSON.parse(arg.message);\n          } catch (parseError) {\n            dialog.close();\n            reject(new Error(\"Invalid auth dialog response.\"));\n            return;\n          }\n\n          if (data.type === \"token\" && data.accessToken) {\n            dialog.close();\n            resolve(data.accessToken);\n            return;\n          }\n\n          dialog.close();\n          reject(new Error(data.message || \"Auth failed.\"));\n        });\n\n        dialog.addEventHandler(Office.EventType.DialogEventReceived, () => {\n          reject(new Error(\"Auth dialog closed.\"));\n        });\n\n        dialog.messageChild(\n          JSON.stringify({\n            clientId: AAD_CLIENT_ID,\n            authority: AAD_AUTHORITY,\n            scopes: GRAPH_SCOPES\n          })\n        );\n      }\n    );\n  });\n}\n\nfunction extractTeamsLink(bodyHtml) {\n  const teamsRegex = /https:\\/\\/teams\\.microsoft\\.com\\/l\\/meetup-join\\/[^\\s\"<]+/i;\n  const safeLinksRegex = /https:\\/\\/[^\\/]+\\.safelinks\\.protection\\.outlook\\.com\\/[^\\s\"<]+/i;\n  const akaTeamsRegex = /https:\\/\\/aka\\.ms\\/[^\\s\"<]*teams[^\\s\"<]*/i;\n  const directLink = findTeamsLinkInText(bodyHtml);\n  if (directLink) {\n    return directLink;\n  }\n\n  const urls = bodyHtml.match(/https?:\\/\\/[^\\s\"'<>]+/gi) || [];\n  for (let i = 0; i < urls.length; i += 1) {\n    const rawUrl = urls[i];\n    const cleanedUrl = rawUrl.replace(/&amp;/g, \"&\");\n\n    if (teamsRegex.test(cleanedUrl)) {\n      return decodeLink(cleanedUrl);\n    }\n\n    if (safeLinksRegex.test(cleanedUrl)) {\n      const extracted = extractSafeLinkTarget(cleanedUrl);\n      if (extracted) {\n        const decoded = decodeLink(extracted);\n        if (teamsRegex.test(decoded)) {\n          return decoded;\n        }\n      }\n    }\n\n    if (akaTeamsRegex.test(cleanedUrl)) {\n      return cleanedUrl;\n    }\n  }\n\n  return null;\n}\n\nfunction findTeamsLinkInText(text) {\n  const candidates = [];\n  const rawMatches = text.match(/https:\\/\\/teams\\.microsoft\\.com\\/l\\/meetup-join\\/[^\\s\"'<>]+/gi);\n  if (rawMatches) {\n    candidates.push(...rawMatches);\n  }\n\n  const decodedHtml = decodeHtmlEntities(text);\n  const decodedMatches = decodedHtml.match(/https:\\/\\/teams\\.microsoft\\.com\\/l\\/meetup-join\\/[^\\s\"'<>]+/gi);\n  if (decodedMatches) {\n    candidates.push(...decodedMatches);\n  }\n\n  for (let i = 0; i < candidates.length; i += 1) {\n    const cleaned = decodeLink(candidates[i]);\n    if (cleaned) {\n      return cleaned;\n    }\n  }\n\n  return null;\n}\n\nfunction decodeLink(url) {\n  const cleaned = url.replace(/&amp;/g, \"&\");\n  if (/%[0-9A-Fa-f]{2}/.test(cleaned)) {\n    try {\n      return decodeURIComponent(cleaned);\n    } catch (error) {\n      return cleaned;\n    }\n  }\n  return cleaned;\n}\n\nfunction decodeHtmlEntities(text) {\n  return text\n    .replace(/&amp;/g, \"&\")\n    .replace(/&lt;/g, \"<\")\n    .replace(/&gt;/g, \">\")\n    .replace(/&quot;/g, \"\\\"\")\n    .replace(/&#39;/g, \"'\");\n}\n\nfunction extractSafeLinkTarget(safeLinkUrl) {\n  try {\n    const url = new URL(safeLinkUrl);\n    const target = url.searchParams.get(\"url\");\n    if (!target) {\n      return null;\n    }\n    return decodeURIComponent(target);\n  } catch (error) {\n    return null;\n  }\n}\n\nfunction logDebug(message, data) {\n  if (!DEBUG_LOGS) {\n    return;\n  }\n\n  if (data) {\n    // eslint-disable-next-line no-console\n    console.log(`[AddTeamsLink] ${message}`, data);\n  } else {\n    // eslint-disable-next-line no-console\n    console.log(`[AddTeamsLink] ${message}`);\n  }\n}\n\n// Register the function with Office.\nOffice.actions.associate(\"addTeamsLinkToLocation\", addTeamsLinkToLocation);\n"],"names":["e","t","r","Symbol","n","iterator","o","toStringTag","i","c","prototype","Generator","u","Object","create","_regeneratorDefine2","f","p","y","G","v","a","d","bind","length","l","TypeError","call","done","value","return","GeneratorFunction","GeneratorFunctionPrototype","getPrototypeOf","setPrototypeOf","__proto__","displayName","_regenerator","w","m","defineProperty","_invoke","enumerable","configurable","writable","_toConsumableArray","Array","isArray","_arrayLikeToArray","_arrayWithoutHoles","from","_iterableToArray","toString","slice","constructor","name","test","_unsupportedIterableToArray","_nonIterableSpread","asyncGeneratorStep","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","Office","onReady","NOTIFICATION_ICON_ID","GRAPH_BASE_URL","GRAPH_SCOPES","cachedGraphToken","cachedGraphTokenExpiresAt","notifySuccess","item","notificationMessages","replaceAsync","type","MailboxEnums","ItemNotificationMessageType","InformationalMessage","icon","persistent","message","concat","notifyError","ErrorMessage","notifyInfo","openCreateEventDialog","teamsLink","subject","context","ui","displayDialogAsync","height","width","displayInIframe","result","status","AsyncResultStatus","Succeeded","dialog","addEventHandler","EventType","DialogMessageReceived","arg","data","JSON","parse","parseError","close","action","start","Date","end","Number","isNaN","valueOf","mailbox","displayNewAppointmentForm","location","DialogEventReceived","messageChild","stringify","_findCalendarEventByGraph","_callee","meetingId","token","url","response","text","items","_context","getGraphAccessToken","getTime","GRAPH_SEARCH_DAYS","encodeURIComponent","toISOString","fetch","headers","Authorization","Prefer","ok","Error","json","eventMatchesTeams","id","_updateCalendarEventLocationGraph","_callee2","eventId","_context2","method","body","_getGraphAccessToken","_callee3","_token","_context3","now","OfficeRuntime","auth","getAccessToken","allowSignInPrompt","allowConsentPrompt","forMSGraphAccess","logDebug","cacheGraphToken","getGraphAccessTokenViaDialog","event","bodyText","content","onlineUrl","onlineMeetingUrl","includes","minutes","reject","accessToken","clientId","authority","scopes","decodeLink","cleaned","replace","decodeURIComponent","error","decodeHtmlEntities","extractSafeLinkTarget","safeLinkUrl","target","URL","searchParams","get","console","log","actions","associate","itemId","itemType","getAsync","CoercionType","Html","bodyResult","completed","bodyHtml","teamsRegex","safeLinksRegex","akaTeamsRegex","directLink","candidates","rawMatches","match","push","decodedMatches","findTeamsLinkInText","urls","cleanedUrl","extracted","decoded","extractTeamsLink","found","Boolean","linkMatch","combined","encodedMatch","extractMeetingId","_x","_x2","findCalendarEventByGraph","_x3","_x4","updateCalendarEventLocationGraph","catch","updateError"],"ignoreList":[],"sourceRoot":""}