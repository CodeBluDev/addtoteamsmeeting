{"version":3,"file":"authDialog.js","mappings":"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","sources":["webpack://office-addin-taskpane-js/./src/dialogs/auth.js"],"sourcesContent":["/* global Office, msal */\n\nconst STORAGE_KEY = \"addTeamsAuthConfig\";\nlet authInProgress = false;\nlet currentConfig = null;\n\nfunction sendMessage(type, payload) {\n  Office.context.ui.messageParent(JSON.stringify({ type, ...payload }));\n}\n\nfunction sendLog(level, message, data) {\n  sendMessage(\"log\", { level, message, data });\n}\n\nfunction setStatus(message) {\n  const el = document.getElementById(\"authStatus\");\n  if (el) {\n    el.textContent = message;\n  }\n}\n\nfunction receiveConfig(message) {\n  try {\n    return JSON.parse(message);\n  } catch (error) {\n    return null;\n  }\n}\n\nfunction saveConfig(config) {\n  try {\n    localStorage.setItem(STORAGE_KEY, JSON.stringify(config));\n  } catch (error) {\n    // Ignore storage errors in constrained browsers.\n  }\n}\n\nfunction loadConfig() {\n  try {\n    const raw = localStorage.getItem(STORAGE_KEY);\n    if (!raw) {\n      return null;\n    }\n    return JSON.parse(raw);\n  } catch (error) {\n    return null;\n  }\n}\n\nasync function startAuth(config) {\n  if (!config || !config.clientId) {\n    return;\n  }\n  if (authInProgress) {\n    sendLog(\"info\", \"Auth already in progress, skipping\");\n    return;\n  }\n  authInProgress = true;\n  setStatus(\"Starting sign-inâ€¦\");\n  sendLog(\"info\", \"Auth config received\", {\n    clientId: config.clientId,\n    authority: config.authority,\n    scopes: config.scopes\n  });\n  const app = createMsalApp(config);\n  const scopes = config.scopes || [\"https://graph.microsoft.com/Calendars.ReadWrite\"];\n\n  try {\n    sendLog(\"info\", \"Starting loginPopup\");\n    const loginResult = await app.loginPopup({\n      scopes,\n      prompt: \"login\"\n    });\n    const loginAccount = loginResult.account;\n    sendLog(\"info\", \"loginPopup succeeded\", {\n      username: loginAccount && loginAccount.username ? loginAccount.username : null\n    });\n    const tokenResult = await app.acquireTokenSilent({\n      scopes,\n      account: loginAccount\n    });\n    setStatus(\"Token acquired.\");\n    sendMessage(\"token\", { accessToken: tokenResult.accessToken });\n    sendLog(\"info\", \"Token acquired via acquireTokenSilent\");\n  } catch (error) {\n    setStatus(`Auth error: ${error.message || \"login failed\"}`);\n    sendLog(\"error\", \"loginPopup failed\", {\n      name: error.name,\n      message: error.message,\n      errorCode: error.errorCode\n    });\n    try {\n      sendLog(\"info\", \"Starting acquireTokenPopup fallback\");\n      const fallback = await app.acquireTokenPopup({\n        scopes,\n        prompt: \"login\"\n      });\n      setStatus(\"Token acquired.\");\n      sendMessage(\"token\", { accessToken: fallback.accessToken });\n      sendLog(\"info\", \"Token acquired via acquireTokenPopup\");\n    } catch (popupError) {\n      setStatus(`Auth error: ${popupError.message || \"login failed\"}`);\n      sendMessage(\"error\", { message: popupError.message || \"Auth failed.\" });\n      sendLog(\"error\", \"acquireTokenPopup failed\", {\n        name: popupError.name,\n        message: popupError.message,\n        errorCode: popupError.errorCode\n      });\n    }\n  } finally {\n    authInProgress = false;\n  }\n}\n\nfunction createMsalApp(config) {\n  const msalConfig = {\n    auth: {\n      clientId: config.clientId,\n      authority: config.authority || \"https://login.microsoftonline.com/organizations\",\n      redirectUri: window.location.origin + window.location.pathname\n    },\n    cache: {\n      cacheLocation: \"localStorage\",\n      storeAuthStateInCookie: true\n    }\n  };\n\n  return new msal.PublicClientApplication(msalConfig);\n}\n\nasync function trySilentAuth(config) {\n  const app = createMsalApp(config);\n  const scopes = config.scopes || [\"https://graph.microsoft.com/Calendars.ReadWrite\"];\n  const account = app.getAllAccounts()[0];\n  if (!account) {\n    return false;\n  }\n\n  try {\n    sendLog(\"info\", \"Account found, acquiring token silently\");\n    const tokenResult = await app.acquireTokenSilent({\n      scopes,\n      account\n    });\n    setStatus(\"Token acquired.\");\n    sendMessage(\"token\", { accessToken: tokenResult.accessToken });\n    sendLog(\"info\", \"Token acquired via acquireTokenSilent\");\n    return true;\n  } catch (error) {\n    sendLog(\"error\", \"Silent token failed\", {\n      name: error.name,\n      message: error.message,\n      errorCode: error.errorCode\n    });\n    return false;\n  }\n}\n\nfunction showStartButton() {\n  const button = document.getElementById(\"authStartButton\");\n  if (button) {\n    button.style.display = \"inline-block\";\n  }\n}\n\nOffice.onReady(() => {\n  setStatus(\"Auth dialog ready\");\n  // eslint-disable-next-line no-console\n  console.log(\"[AuthDialog] ready\");\n  sendLog(\"info\", \"Auth dialog ready\", { origin: window.location.origin });\n\n  window.addEventListener(\"error\", (event) => {\n    sendLog(\"error\", \"Auth dialog error\", {\n      message: event.message,\n      filename: event.filename,\n      lineno: event.lineno,\n      colno: event.colno\n    });\n  });\n\n  window.addEventListener(\"unhandledrejection\", (event) => {\n    const reason = event.reason || {};\n    sendLog(\"error\", \"Auth dialog unhandled rejection\", {\n      message: reason.message || String(reason)\n    });\n  });\n\n  Office.context.ui.addHandlerAsync(\n    Office.EventType.DialogParentMessageReceived,\n    async (arg) => {\n      const config = receiveConfig(arg.message);\n      if (!config || !config.clientId) {\n        setStatus(\"Missing auth config.\");\n        sendMessage(\"error\", { message: \"Missing auth configuration.\" });\n        sendLog(\"error\", \"Missing auth configuration.\");\n        return;\n      }\n\n      saveConfig(config);\n      currentConfig = config;\n      const silentOk = await trySilentAuth(config);\n      if (!silentOk) {\n        setStatus(\"Ready to sign in.\");\n        showStartButton();\n      }\n    }\n  );\n\n  sendMessage(\"ready\", {});\n\n  const storedConfig = loadConfig();\n  if (storedConfig && storedConfig.clientId) {\n    currentConfig = storedConfig;\n    trySilentAuth(storedConfig).then((silentOk) => {\n      if (!silentOk) {\n        setStatus(\"Ready to sign in.\");\n        showStartButton();\n      }\n    });\n  }\n\n  const button = document.getElementById(\"authStartButton\");\n  if (button) {\n    button.addEventListener(\"click\", () => {\n      sendLog(\"info\", \"User clicked sign-in button\");\n      showStartButton();\n      startAuth(currentConfig);\n    });\n  }\n});\n"],"names":["e","t","r","Symbol","n","iterator","o","toStringTag","i","c","prototype","Generator","u","Object","create","_regeneratorDefine2","f","p","y","G","v","a","d","bind","length","l","TypeError","call","done","value","return","GeneratorFunction","GeneratorFunctionPrototype","getPrototypeOf","setPrototypeOf","__proto__","displayName","_regenerator","w","m","defineProperty","_invoke","enumerable","configurable","writable","asyncGeneratorStep","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","ownKeys","keys","getOwnPropertySymbols","filter","getOwnPropertyDescriptor","push","_defineProperty","_typeof","toPrimitive","String","_toPrimitive","_toPropertyKey","STORAGE_KEY","authInProgress","currentConfig","sendMessage","type","payload","Office","context","ui","messageParent","JSON","stringify","forEach","getOwnPropertyDescriptors","defineProperties","_objectSpread","sendLog","level","message","data","setStatus","el","document","getElementById","textContent","receiveConfig","parse","error","saveConfig","config","localStorage","setItem","_startAuth","_callee2","app","scopes","loginResult","loginAccount","tokenResult","fallback","_t","_t2","_context2","clientId","authority","createMsalApp","loginPopup","prompt","username","account","acquireTokenSilent","accessToken","concat","name","errorCode","acquireTokenPopup","msalConfig","auth","redirectUri","window","location","origin","pathname","cache","cacheLocation","storeAuthStateInCookie","msal","PublicClientApplication","trySilentAuth","_x2","_trySilentAuth","_callee3","_t3","_context3","getAllAccounts","showStartButton","button","style","display","onReady","console","log","addEventListener","event","filename","lineno","colno","reason","addHandlerAsync","EventType","DialogParentMessageReceived","_ref","_callee","arg","_context","_x3","storedConfig","raw","getItem","loadConfig","silentOk","_x","startAuth"],"ignoreList":[],"sourceRoot":""}