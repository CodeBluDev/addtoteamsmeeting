{"version":3,"file":"commands.js","mappings":"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","sources":["webpack://office-addin-taskpane-js/./src/commands/commands.js"],"sourcesContent":["/*\n * Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.\n * See LICENSE in the project root for license information.\n */\n\n/* global Office, OfficeRuntime */\n\nOffice.onReady(() => {\n  // If needed, Office.js is ready to be called.\n});\n\nconst BUILD_TAG = \"v1.8.22\";\nconst BUILD_MARKER = \"2026-01-16T12:33Z\";\nconst DEFAULT_BASE_URL = \"https://salmon-pebble-0aae76c0f.6.azurestaticapps.net\";\nconst CACHE_BUSTER = \"1.8.22\";\nconst EWS_MESSAGES_NS = \"http://schemas.microsoft.com/exchange/services/2006/messages\";\nconst EWS_TYPES_NS = \"http://schemas.microsoft.com/exchange/services/2006/types\";\nconst DEBUG_LOGS = true;\nconst NOTIFICATION_ICON_ID = \"Icon.16x16\";\nconst DIALOG_URL = getDialogUrl(\"create-event.html\");\nconst GRAPH_BASE_URL = \"https://graph.microsoft.com/v1.0\";\nconst GRAPH_SEARCH_DAYS = 365;\nconst AAD_CLIENT_ID = \"226fcb0c-fa77-48bb-a20e-70a75ce176fd\";\nconst AAD_AUTHORITY = \"https://login.microsoftonline.com/organizations\";\nconst GRAPH_SCOPES = [\"https://graph.microsoft.com/Calendars.ReadWrite\"];\nconst AUTH_DIALOG_URL = getDialogUrl(\"auth.html\");\nlet cachedGraphToken = null;\nlet cachedGraphTokenExpiresAt = 0;\nconst GRAPH_TOKEN_STORAGE_KEY = \"addTeamsGraphToken\";\n\n/**\n * Shows a notification when the add-in command is executed.\n * @param event {Office.AddinCommands.Event}\n */\nfunction addTeamsLinkToLocation(event) {\n  const item = Office.context.mailbox.item;\n  logDebug(\"Command invoked\", { itemId: item.itemId, itemType: item.itemType });\n\n  // Read the message body as HTML\n  item.body.getAsync(Office.CoercionType.Html, (bodyResult) => {\n    logDebug(\"Body getAsync result\", { status: bodyResult.status });\n    if (bodyResult.status !== Office.AsyncResultStatus.Succeeded) {\n      item.notificationMessages.replaceAsync(\"error\", {\n        type: Office.MailboxEnums.ItemNotificationMessageType.ErrorMessage,\n        message: \"Unable to read message body.\"\n      });\n      event.completed();\n      return;\n    }\n\n    const bodyHtml = bodyResult.value;\n\n    // Extract the Teams meeting link\n    const teamsLink = extractTeamsLink(bodyHtml);\n    logDebug(\"Teams link match\", { found: Boolean(teamsLink) });\n\n    if (!teamsLink) {\n      notifyInfo(item, \"No Microsoft Teams meeting link found in this invite.\");\n      event.completed();\n      return;\n    }\n\n    const meetingId = extractMeetingId(bodyHtml, teamsLink);\n    logDebug(\"Teams meeting id extracted\", { meetingId });\n\n    (async () => {\n      try {\n        const eventId = await findCalendarEventByGraph(teamsLink, meetingId);\n        if (!eventId) {\n          notifyInfo(item, \"No matching calendar event found. Opening event dialog.\");\n          openCreateEventDialog(item, teamsLink);\n          return;\n        }\n\n        await updateCalendarEventLocationGraph(eventId, teamsLink);\n        notifySuccess(item);\n      } catch (error) {\n        logDebug(\"Graph update failed\", { message: error.message });\n        notifyError(item, \"Unable to update the calendar location via Microsoft Graph.\");\n      } finally {\n        event.completed();\n      }\n    })();\n  });\n}\n\nfunction notifySuccess(item) {\n  item.notificationMessages.replaceAsync(\"success\", {\n    type: Office.MailboxEnums.ItemNotificationMessageType.InformationalMessage,\n    icon: NOTIFICATION_ICON_ID,\n    persistent: false,\n    message: `Teams meeting link added to Location. (${BUILD_TAG} | ${BUILD_MARKER})`\n  });\n}\n\nfunction notifyError(item, message) {\n  item.notificationMessages.replaceAsync(\"error\", {\n    type: Office.MailboxEnums.ItemNotificationMessageType.ErrorMessage,\n    message\n  });\n}\n\nfunction notifyInfo(item, message) {\n  item.notificationMessages.replaceAsync(\"info\", {\n    type: Office.MailboxEnums.ItemNotificationMessageType.InformationalMessage,\n    icon: NOTIFICATION_ICON_ID,\n    persistent: false,\n    message\n  });\n}\n\nfunction getUtcWindowStart() {\n  const now = new Date();\n  now.setDate(now.getDate() - 7);\n  return now.toISOString();\n}\n\nfunction getUtcWindowEnd() {\n  const now = new Date();\n  now.setDate(now.getDate() + 90);\n  return now.toISOString();\n}\n\nfunction openCreateEventDialog(item, teamsLink) {\n  const baseSubject = item.subject || \"Teams meeting\";\n  const subject = prependBuildTag(baseSubject);\n\n  Office.context.ui.displayDialogAsync(\n    DIALOG_URL,\n    { height: 55, width: 35, displayInIframe: true },\n    (result) => {\n      if (result.status !== Office.AsyncResultStatus.Succeeded) {\n        notifyError(item, \"Unable to open the event dialog.\");\n        return;\n      }\n\n      const dialog = result.value;\n      dialog.addEventHandler(Office.EventType.DialogMessageReceived, (arg) => {\n        let data;\n        try {\n          data = JSON.parse(arg.message);\n        } catch (parseError) {\n          notifyError(item, \"Invalid response from dialog.\");\n          dialog.close();\n          return;\n        }\n\n        if (data.action === \"cancel\") {\n          dialog.close();\n          return;\n        }\n\n        if (data.action !== \"create\") {\n          notifyError(item, \"Unknown dialog response.\");\n          dialog.close();\n          return;\n        }\n\n        const start = new Date(data.start);\n        const end = new Date(data.end);\n        if (Number.isNaN(start.valueOf()) || Number.isNaN(end.valueOf())) {\n          notifyError(item, \"Invalid date/time from dialog.\");\n          dialog.close();\n          return;\n        }\n\n        const subjectWithTag = prependBuildTag(data.subject || baseSubject);\n        Office.context.mailbox.displayNewAppointmentForm({\n          subject: subjectWithTag,\n          location: teamsLink,\n          start,\n          end\n        });\n\n        dialog.close();\n        notifySuccess(item);\n      });\n\n      dialog.addEventHandler(Office.EventType.DialogEventReceived, () => {\n        notifyInfo(item, \"Event dialog closed.\");\n      });\n\n      dialog.messageChild(\n        JSON.stringify({\n          subject,\n          teamsLink\n        })\n      );\n    }\n  );\n}\n\nfunction prependBuildTag(subject) {\n  const prefix = `[${BUILD_TAG}] `;\n  if (!subject) {\n    return prefix.trim();\n  }\n  if (subject.startsWith(prefix)) {\n    return subject;\n  }\n  return `${prefix}${subject}`;\n}\n\nfunction getMessageTimeRange(item, callback) {\n  if (!item.start || !item.end || !item.start.getAsync || !item.end.getAsync) {\n    callback(null, null);\n    return;\n  }\n\n  item.start.getAsync((startResult) => {\n    if (startResult.status !== Office.AsyncResultStatus.Succeeded) {\n      callback(startResult.error, null);\n      return;\n    }\n\n    item.end.getAsync((endResult) => {\n      if (endResult.status !== Office.AsyncResultStatus.Succeeded) {\n        callback(endResult.error, null);\n        return;\n      }\n\n      const start = new Date(startResult.value);\n      const end = new Date(endResult.value);\n      if (Number.isNaN(start.valueOf()) || Number.isNaN(end.valueOf())) {\n        callback(null, null);\n        return;\n      }\n\n      callback(null, { start, end });\n    });\n  });\n}\n\nfunction findCalendarItemByTeamsLink(teamsLink, callback) {\n  const escapedLink = escapeXml(teamsLink);\n  logDebug(\"EWS FindItem by link request prepared\");\n  const request = `<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<soap:Envelope xmlns:soap=\"http://schemas.xmlsoap.org/soap/envelope/\"\n               xmlns:t=\"${EWS_TYPES_NS}\"\n               xmlns:m=\"${EWS_MESSAGES_NS}\">\n  <soap:Header>\n    <t:RequestServerVersion Version=\"Exchange2013\" />\n  </soap:Header>\n  <soap:Body>\n    <m:FindItem Traversal=\"Shallow\">\n      <m:ItemShape>\n        <t:BaseShape>IdOnly</t:BaseShape>\n      </m:ItemShape>\n      <m:CalendarView StartDate=\"${getUtcWindowStart()}\" EndDate=\"${getUtcWindowEnd()}\" />\n      <m:Restriction>\n        <t:Contains ContainmentMode=\"Substring\" ContainmentComparison=\"IgnoreCase\">\n          <t:FieldURI FieldURI=\"item:Body\" />\n          <t:Constant Value=\"${escapedLink}\" />\n        </t:Contains>\n      </m:Restriction>\n      <m:ParentFolderIds>\n        <t:DistinguishedFolderId Id=\"calendar\" />\n      </m:ParentFolderIds>\n    </m:FindItem>\n  </soap:Body>\n</soap:Envelope>`;\n\n  Office.context.mailbox.makeEwsRequestAsync(request, (result) => {\n    logEwsResult(\"FindItem by link\", result);\n    if (result.status !== Office.AsyncResultStatus.Succeeded) {\n      callback(result.error, null);\n      return;\n    }\n\n    const calendarItem = parseFirstCalendarItem(result.value);\n    callback(null, calendarItem);\n  });\n}\n\nfunction runEwsHealthCheck(callback) {\n  logDebug(\"EWS health check request prepared\");\n  const request = `<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<soap:Envelope xmlns:soap=\"http://schemas.xmlsoap.org/soap/envelope/\"\n               xmlns:t=\"${EWS_TYPES_NS}\"\n               xmlns:m=\"${EWS_MESSAGES_NS}\">\n  <soap:Header>\n    <t:RequestServerVersion Version=\"Exchange2013\" />\n  </soap:Header>\n  <soap:Body>\n    <m:GetFolder>\n      <m:FolderShape>\n        <t:BaseShape>IdOnly</t:BaseShape>\n      </m:FolderShape>\n      <m:FolderIds>\n        <t:DistinguishedFolderId Id=\"calendar\" />\n      </m:FolderIds>\n    </m:GetFolder>\n  </soap:Body>\n</soap:Envelope>`;\n\n  Office.context.mailbox.makeEwsRequestAsync(request, (result) => {\n    logEwsResult(\"health check\", result);\n\n    if (result.status !== Office.AsyncResultStatus.Succeeded) {\n      callback(false, formatEwsError(result.error));\n      return;\n    }\n\n    const xmlDoc = parseXml(result.value);\n    if (!xmlDoc || !isEwsResponseSuccess(xmlDoc)) {\n      callback(false, \"EWS GetFolder failed.\");\n      return;\n    }\n\n    callback(true, \"OK\");\n  });\n}\n\nfunction findCalendarItemByTimeRange(timeRange, callback) {\n  const startIso = timeRange.start.toISOString();\n  const endIso = timeRange.end.toISOString();\n  logDebug(\"EWS FindItem by time request prepared\", { startIso, endIso });\n  const request = `<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<soap:Envelope xmlns:soap=\"http://schemas.xmlsoap.org/soap/envelope/\"\n               xmlns:t=\"${EWS_TYPES_NS}\"\n               xmlns:m=\"${EWS_MESSAGES_NS}\">\n  <soap:Header>\n    <t:RequestServerVersion Version=\"Exchange2013\" />\n  </soap:Header>\n  <soap:Body>\n    <m:FindItem Traversal=\"Shallow\">\n      <m:ItemShape>\n        <t:BaseShape>IdOnly</t:BaseShape>\n        <t:AdditionalProperties>\n          <t:FieldURI FieldURI=\"calendar:Start\" />\n          <t:FieldURI FieldURI=\"calendar:End\" />\n        </t:AdditionalProperties>\n      </m:ItemShape>\n      <m:CalendarView StartDate=\"${startIso}\" EndDate=\"${endIso}\" />\n      <m:ParentFolderIds>\n        <t:DistinguishedFolderId Id=\"calendar\" />\n      </m:ParentFolderIds>\n    </m:FindItem>\n  </soap:Body>\n</soap:Envelope>`;\n\n  Office.context.mailbox.makeEwsRequestAsync(request, (result) => {\n    logEwsResult(\"FindItem by time\", result);\n    if (result.status !== Office.AsyncResultStatus.Succeeded) {\n      callback(result.error, null);\n      return;\n    }\n\n    const calendarItem = parseCalendarItemByTime(result.value, timeRange);\n    callback(null, calendarItem);\n  });\n}\n\nfunction updateCalendarItemLocation(calendarItem, location, callback) {\n  const escapedLocation = escapeXml(location);\n  logDebug(\"EWS UpdateItem request prepared\", { itemId: calendarItem.id });\n  const request = `<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<soap:Envelope xmlns:soap=\"http://schemas.xmlsoap.org/soap/envelope/\"\n               xmlns:t=\"${EWS_TYPES_NS}\"\n               xmlns:m=\"${EWS_MESSAGES_NS}\">\n  <soap:Header>\n    <t:RequestServerVersion Version=\"Exchange2013\" />\n  </soap:Header>\n  <soap:Body>\n    <m:UpdateItem ConflictResolution=\"AlwaysOverwrite\" SendMeetingInvitationsOrCancellations=\"SendToNone\">\n      <m:ItemChanges>\n        <t:ItemChange>\n          <t:ItemId Id=\"${calendarItem.id}\" ChangeKey=\"${calendarItem.changeKey}\" />\n          <t:Updates>\n            <t:SetItemField>\n              <t:FieldURI FieldURI=\"calendar:Location\" />\n              <t:CalendarItem>\n                <t:Location>${escapedLocation}</t:Location>\n              </t:CalendarItem>\n            </t:SetItemField>\n          </t:Updates>\n        </t:ItemChange>\n      </m:ItemChanges>\n    </m:UpdateItem>\n  </soap:Body>\n</soap:Envelope>`;\n\n  Office.context.mailbox.makeEwsRequestAsync(request, (result) => {\n    logEwsResult(\"UpdateItem\", result);\n    if (result.status !== Office.AsyncResultStatus.Succeeded) {\n      callback(result.error);\n      return;\n    }\n\n    const xmlDoc = parseXml(result.value);\n    if (!xmlDoc || !isEwsResponseSuccess(xmlDoc)) {\n      callback(new Error(\"EWS UpdateItem failed.\"));\n      return;\n    }\n\n    callback(null);\n  });\n}\n\nfunction parseFirstCalendarItem(responseText) {\n  const xmlDoc = parseXml(responseText);\n  if (!xmlDoc) {\n    return null;\n  }\n\n  const itemId = xmlDoc.getElementsByTagNameNS(EWS_TYPES_NS, \"ItemId\")[0];\n  if (!itemId) {\n    return null;\n  }\n\n  return {\n    id: itemId.getAttribute(\"Id\"),\n    changeKey: itemId.getAttribute(\"ChangeKey\")\n  };\n}\n\nfunction parseCalendarItemByTime(responseText, timeRange) {\n  const xmlDoc = parseXml(responseText);\n  if (!xmlDoc) {\n    return null;\n  }\n\n  const calendarItems = xmlDoc.getElementsByTagNameNS(EWS_TYPES_NS, \"CalendarItem\");\n  for (let i = 0; i < calendarItems.length; i += 1) {\n    const calendarItem = calendarItems[i];\n    const startNode = calendarItem.getElementsByTagNameNS(EWS_TYPES_NS, \"Start\")[0];\n    const endNode = calendarItem.getElementsByTagNameNS(EWS_TYPES_NS, \"End\")[0];\n    const itemId = calendarItem.getElementsByTagNameNS(EWS_TYPES_NS, \"ItemId\")[0];\n\n    if (!startNode || !endNode || !itemId) {\n      continue;\n    }\n\n    const start = new Date(startNode.textContent);\n    const end = new Date(endNode.textContent);\n    if (Number.isNaN(start.valueOf()) || Number.isNaN(end.valueOf())) {\n      continue;\n    }\n\n    if (isSameTimeRange(start, end, timeRange)) {\n      return {\n        id: itemId.getAttribute(\"Id\"),\n        changeKey: itemId.getAttribute(\"ChangeKey\")\n      };\n    }\n  }\n\n  return null;\n}\n\nfunction isSameTimeRange(start, end, timeRange) {\n  const toleranceMs = 60000;\n  return (\n    Math.abs(start - timeRange.start) <= toleranceMs &&\n    Math.abs(end - timeRange.end) <= toleranceMs\n  );\n}\n\nfunction parseXml(xmlString) {\n  if (!xmlString) {\n    return null;\n  }\n\n  return new DOMParser().parseFromString(xmlString, \"text/xml\");\n}\n\nfunction isEwsResponseSuccess(xmlDoc) {\n  const responseCode = xmlDoc.getElementsByTagNameNS(EWS_MESSAGES_NS, \"ResponseCode\")[0];\n  return responseCode && responseCode.textContent === \"NoError\";\n}\n\nfunction escapeXml(value) {\n  return String(value)\n    .replace(/&/g, \"&amp;\")\n    .replace(/</g, \"&lt;\")\n    .replace(/>/g, \"&gt;\")\n    .replace(/\"/g, \"&quot;\")\n    .replace(/'/g, \"&apos;\");\n}\n\nfunction extractMeetingId(bodyHtml, teamsLink) {\n  if (teamsLink) {\n    const linkMatch = teamsLink.match(/19:meeting_[^/?\"'\\\\s<>]+/i);\n    if (linkMatch) {\n      return linkMatch[0];\n    }\n  }\n\n  const combined = `${bodyHtml} ${teamsLink || \"\"}`;\n  const decoded = decodeHtmlEntities(decodeLink(combined));\n  const match = decoded.match(/19:meeting_[^/?\"'\\\\s<>]+/i);\n  if (match) {\n    return match[0];\n  }\n\n  const encodedMatch = combined.match(/19%3Ameeting_[^\"'\\\\s<>%]+/i);\n  if (encodedMatch) {\n    return decodeLink(encodedMatch[0]);\n  }\n\n  return null;\n}\n\nasync function findCalendarEventByGraph(teamsLink, meetingId) {\n  const token = await getGraphAccessToken();\n  const start = new Date();\n  const end = new Date(start.getTime() + GRAPH_SEARCH_DAYS * 24 * 60 * 60 * 1000);\n  let url = `${GRAPH_BASE_URL}/me/calendarView?startDateTime=${encodeURIComponent(\n    start.toISOString()\n  )}&endDateTime=${encodeURIComponent(end.toISOString())}` +\n    \"&$select=id,subject,body,location,onlineMeetingUrl,start,end\";\n\n  while (url) {\n    logDebug(\"Graph calendarView request\", {\n      method: \"GET\",\n      url,\n      headers: {\n        Authorization: exposeAuthHeader(token),\n        Prefer: 'outlook.body-content-type=\"text\"'\n      }\n    });\n    const response = await fetch(url, {\n      headers: {\n        Authorization: `Bearer ${token}`,\n        Prefer: 'outlook.body-content-type=\"text\"'\n      }\n    });\n\n    await logGraphResponse(\"calendarView\", response);\n    if (!response.ok) {\n      const text = await response.text();\n      throw new Error(`Graph calendarView failed: ${response.status} ${text}`);\n    }\n\n    const data = await response.json();\n    const items = data.value || [];\n    logDebug(\"Graph calendarView items\", {\n      count: items.length,\n      sample: items.slice(0, 5).map((item) => summarizeGraphItem(item, teamsLink, meetingId))\n    });\n\n    for (let i = 0; i < items.length; i += 1) {\n      if (eventMatchesTeams(items[i], teamsLink, meetingId)) {\n        return items[i].id;\n      }\n    }\n\n    url = data[\"@odata.nextLink\"] || null;\n  }\n\n  return null;\n}\n\nasync function updateCalendarEventLocationGraph(eventId, teamsLink) {\n  const token = await getGraphAccessToken();\n  const body = {\n    location: {\n      displayName: teamsLink\n    }\n  };\n  logDebug(\"Graph update request\", {\n    method: \"PATCH\",\n    url: `${GRAPH_BASE_URL}/me/events/${eventId}`,\n    headers: {\n      Authorization: exposeAuthHeader(token),\n      \"Content-Type\": \"application/json\"\n    },\n    body\n  });\n  const response = await fetch(`${GRAPH_BASE_URL}/me/events/${eventId}`, {\n    method: \"PATCH\",\n    headers: {\n      Authorization: `Bearer ${token}`,\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify(body)\n  });\n\n  await logGraphResponse(\"updateEvent\", response);\n  if (!response.ok) {\n    const text = await response.text();\n    throw new Error(`Graph update failed: ${response.status} ${text}`);\n  }\n}\n\nasync function getGraphAccessToken() {\n  if (cachedGraphToken && Date.now() < cachedGraphTokenExpiresAt) {\n    return cachedGraphToken;\n  }\n\n  const stored = readStoredGraphToken();\n  if (stored) {\n    cachedGraphToken = stored.token;\n    cachedGraphTokenExpiresAt = stored.expiresAt;\n    logDebug(\"Graph token loaded from storage\");\n    return stored.token;\n  }\n\n  if (OfficeRuntime && OfficeRuntime.auth && OfficeRuntime.auth.getAccessToken) {\n    try {\n      const token = await OfficeRuntime.auth.getAccessToken({\n        allowSignInPrompt: true,\n        allowConsentPrompt: true,\n        forMSGraphAccess: true\n      });\n      logDebug(\"Graph token acquired (OfficeRuntime)\");\n      cacheGraphToken(token, 50);\n      return token;\n    } catch (error) {\n      logDebug(\"OfficeRuntime auth failed\", { message: error.message });\n    }\n  }\n\n  const token = await getGraphAccessTokenViaDialog();\n  logDebug(\"Graph token acquired (dialog)\");\n  cacheGraphToken(token, 45);\n  storeGraphToken(token);\n  return token;\n}\n\nfunction eventMatchesTeams(event, teamsLink, meetingId) {\n  const bodyText = normalizeText(event.body && event.body.content ? event.body.content : \"\");\n  const onlineUrl = normalizeText(event.onlineMeetingUrl || \"\");\n  const locationText = normalizeText(\n    event.location && event.location.displayName ? event.location.displayName : \"\"\n  );\n  const normalizedMeetingId = normalizeText(meetingId || \"\");\n  const normalizedTeamsLink = normalizeText(teamsLink || \"\");\n\n  if (normalizedMeetingId) {\n    if (\n      bodyText.includes(normalizedMeetingId) ||\n      onlineUrl.includes(normalizedMeetingId) ||\n      locationText.includes(normalizedMeetingId)\n    ) {\n      return true;\n    }\n  }\n\n  if (normalizedTeamsLink) {\n    if (\n      bodyText.includes(normalizedTeamsLink) ||\n      onlineUrl.includes(normalizedTeamsLink) ||\n      locationText.includes(normalizedTeamsLink)\n    ) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nfunction cacheGraphToken(token, minutes) {\n  cachedGraphToken = token;\n  cachedGraphTokenExpiresAt = Date.now() + minutes * 60 * 1000;\n}\n\nfunction storeGraphToken(token) {\n  const expiresAt = decodeJwtExpiresAt(token);\n  if (!expiresAt) {\n    return;\n  }\n  try {\n    localStorage.setItem(\n      GRAPH_TOKEN_STORAGE_KEY,\n      JSON.stringify({ token, expiresAt })\n    );\n  } catch (error) {\n    // Ignore storage errors.\n  }\n}\n\nfunction readStoredGraphToken() {\n  try {\n    const raw = localStorage.getItem(GRAPH_TOKEN_STORAGE_KEY);\n    if (!raw) {\n      return null;\n    }\n    const parsed = JSON.parse(raw);\n    if (!parsed || !parsed.token || !parsed.expiresAt) {\n      return null;\n    }\n    if (Date.now() >= parsed.expiresAt - 60 * 1000) {\n      localStorage.removeItem(GRAPH_TOKEN_STORAGE_KEY);\n      return null;\n    }\n    return parsed;\n  } catch (error) {\n    return null;\n  }\n}\n\nfunction decodeJwtExpiresAt(token) {\n  try {\n    const parts = token.split(\".\");\n    if (parts.length < 2) {\n      return null;\n    }\n    const payload = JSON.parse(atob(parts[1].replace(/-/g, \"+\").replace(/_/g, \"/\")));\n    if (!payload || !payload.exp) {\n      return null;\n    }\n    return payload.exp * 1000;\n  } catch (error) {\n    return null;\n  }\n}\n\nfunction getGraphAccessTokenViaDialog() {\n  return new Promise((resolve, reject) => {\n    Office.context.ui.displayDialogAsync(\n      AUTH_DIALOG_URL,\n      { height: 60, width: 40, displayInIframe: false },\n      (result) => {\n        if (result.status !== Office.AsyncResultStatus.Succeeded) {\n          const message = result.error && result.error.message ? result.error.message : \"Unknown dialog error.\";\n          logDebug(\"Auth dialog open failed\", { code: result.error && result.error.code, message });\n          reject(new Error(`Unable to open auth dialog: ${message}`));\n          return;\n        }\n\n        const dialog = result.value;\n        dialog.addEventHandler(Office.EventType.DialogMessageReceived, (arg) => {\n          let data;\n          try {\n            data = JSON.parse(arg.message);\n          } catch (parseError) {\n            dialog.close();\n            reject(new Error(\"Invalid auth dialog response.\"));\n            return;\n          }\n\n          if (data.type === \"log\") {\n            logDebug(\"Auth dialog log\", {\n              level: data.level,\n              message: data.message,\n              data: data.data || null\n            });\n            return;\n          }\n\n          if (data.type === \"ready\") {\n            dialog.messageChild(\n              JSON.stringify({\n                clientId: AAD_CLIENT_ID,\n                authority: AAD_AUTHORITY,\n                scopes: GRAPH_SCOPES\n              })\n            );\n            return;\n          }\n\n          if (data.type === \"token\" && data.accessToken) {\n            dialog.close();\n            resolve(data.accessToken);\n            return;\n          }\n\n          dialog.close();\n          reject(new Error(data.message || \"Auth failed.\"));\n        });\n\n        dialog.addEventHandler(Office.EventType.DialogEventReceived, (arg) => {\n          logDebug(\"Auth dialog event\", { error: arg && arg.error ? arg.error : null });\n          reject(new Error(\"Auth dialog closed.\"));\n        });\n      }\n    );\n  });\n}\n\nfunction extractTeamsLink(bodyHtml) {\n  const teamsRegex = /https:\\/\\/teams\\.microsoft\\.com\\/l\\/meetup-join\\/[^\\s\"<]+/i;\n  const safeLinksRegex = /https:\\/\\/[^\\/]+\\.safelinks\\.protection\\.outlook\\.com\\/[^\\s\"<]+/i;\n  const akaTeamsRegex = /https:\\/\\/aka\\.ms\\/[^\\s\"<]*teams[^\\s\"<]*/i;\n  const directLink = findTeamsLinkInText(bodyHtml);\n  if (directLink) {\n    return directLink;\n  }\n\n  const urls = bodyHtml.match(/https?:\\/\\/[^\\s\"'<>]+/gi) || [];\n  for (let i = 0; i < urls.length; i += 1) {\n    const rawUrl = urls[i];\n    const cleanedUrl = rawUrl.replace(/&amp;/g, \"&\");\n\n    if (teamsRegex.test(cleanedUrl)) {\n      return decodeLink(cleanedUrl);\n    }\n\n    if (safeLinksRegex.test(cleanedUrl)) {\n      const extracted = extractSafeLinkTarget(cleanedUrl);\n      if (extracted) {\n        const decoded = decodeLink(extracted);\n        if (teamsRegex.test(decoded)) {\n          return decoded;\n        }\n      }\n    }\n\n    if (akaTeamsRegex.test(cleanedUrl)) {\n      return cleanedUrl;\n    }\n  }\n\n  return null;\n}\n\nfunction findTeamsLinkInText(text) {\n  const candidates = [];\n  const rawMatches = text.match(/https:\\/\\/teams\\.microsoft\\.com\\/l\\/meetup-join\\/[^\\s\"'<>]+/gi);\n  if (rawMatches) {\n    candidates.push(...rawMatches);\n  }\n\n  const decodedHtml = decodeHtmlEntities(text);\n  const decodedMatches = decodedHtml.match(/https:\\/\\/teams\\.microsoft\\.com\\/l\\/meetup-join\\/[^\\s\"'<>]+/gi);\n  if (decodedMatches) {\n    candidates.push(...decodedMatches);\n  }\n\n  for (let i = 0; i < candidates.length; i += 1) {\n    const cleaned = decodeLink(candidates[i]);\n    if (cleaned) {\n      return cleaned;\n    }\n  }\n\n  return null;\n}\n\nfunction decodeLink(url) {\n  const cleaned = url.replace(/&amp;/g, \"&\");\n  if (/%[0-9A-Fa-f]{2}/.test(cleaned)) {\n    try {\n      return decodeURIComponent(cleaned);\n    } catch (error) {\n      return cleaned;\n    }\n  }\n  return cleaned;\n}\n\nfunction decodeHtmlEntities(text) {\n  return text\n    .replace(/&amp;/g, \"&\")\n    .replace(/&lt;/g, \"<\")\n    .replace(/&gt;/g, \">\")\n    .replace(/&quot;/g, \"\\\"\")\n    .replace(/&#39;/g, \"'\");\n}\n\nfunction normalizeText(text) {\n  if (!text) {\n    return \"\";\n  }\n  const decoded = decodeHtmlEntities(String(text));\n  const cleaned = decodeLink(decoded);\n  return cleaned.toLowerCase();\n}\n\nfunction summarizeGraphItem(item, teamsLink, meetingId) {\n  const bodyText = normalizeText(item.body && item.body.content ? item.body.content : \"\");\n  const onlineUrl = normalizeText(item.onlineMeetingUrl || \"\");\n  const locationText = normalizeText(\n    item.location && item.location.displayName ? item.location.displayName : \"\"\n  );\n  const normalizedMeetingId = normalizeText(meetingId || \"\");\n  const normalizedTeamsLink = normalizeText(teamsLink || \"\");\n  return {\n    id: item.id || null,\n    subject: item.subject || null,\n    start: item.start && item.start.dateTime ? item.start.dateTime : null,\n    onlineMeetingUrl: item.onlineMeetingUrl || null,\n    location: item.location && item.location.displayName ? item.location.displayName : null,\n    hasMeetingId: Boolean(\n      normalizedMeetingId &&\n        (bodyText.includes(normalizedMeetingId) ||\n          onlineUrl.includes(normalizedMeetingId) ||\n          locationText.includes(normalizedMeetingId))\n    ),\n    hasTeamsLink: Boolean(\n      normalizedTeamsLink &&\n        (bodyText.includes(normalizedTeamsLink) ||\n          onlineUrl.includes(normalizedTeamsLink) ||\n          locationText.includes(normalizedTeamsLink))\n    )\n  };\n}\n\nfunction extractSafeLinkTarget(safeLinkUrl) {\n  try {\n    const url = new URL(safeLinkUrl);\n    const target = url.searchParams.get(\"url\");\n    if (!target) {\n      return null;\n    }\n    return decodeURIComponent(target);\n  } catch (error) {\n    return null;\n  }\n}\n\nfunction getBaseUrl() {\n  if (typeof window !== \"undefined\" && window.location && window.location.origin) {\n    return window.location.origin;\n  }\n  return DEFAULT_BASE_URL;\n}\n\nfunction getDialogUrl(path) {\n  const baseUrl = getBaseUrl();\n  return `${baseUrl}/${path}?v=${CACHE_BUSTER}`;\n}\n\nfunction formatEwsError(error) {\n  if (!error) {\n    return \"Unknown error\";\n  }\n\n  const name = error.name || \"EWS error\";\n  const message = error.message || \"No message\";\n  return `${name}: ${message}`;\n}\n\nfunction logDebug(message, data) {\n  if (!DEBUG_LOGS) {\n    return;\n  }\n\n  if (data) {\n    // eslint-disable-next-line no-console\n    console.log(`[AddTeamsLink] ${message}`, data);\n  } else {\n    // eslint-disable-next-line no-console\n    console.log(`[AddTeamsLink] ${message}`);\n  }\n}\n\nasync function logGraphResponse(label, response) {\n  try {\n    const text = await response.clone().text();\n    logDebug(\"Graph response\", {\n      label,\n      status: response.status,\n      ok: response.ok,\n      url: response.url,\n      text\n    });\n  } catch (error) {\n    logDebug(\"Graph response read failed\", { label, message: error.message });\n  }\n}\n\nfunction logEwsResult(label, result) {\n  const errorString = result.error ? formatEwsError(result.error) : null;\n  const error = result.error\n    ? {\n        name: result.error.name,\n        message: result.error.message,\n        code: result.error.code,\n        debugInfo: result.error.debugInfo || null\n      }\n    : null;\n  const value = typeof result.value === \"string\" ? result.value : \"\";\n  logDebug(`EWS ${label} response`, {\n    status: result.status,\n    errorString,\n    errorJson: result.error ? JSON.stringify(result.error) : null,\n    error,\n    valueLength: value.length,\n    valuePreview: value ? value.slice(0, 2000) : null\n  });\n}\n\nfunction exposeAuthHeader(token) {\n  if (!token) {\n    return \"Bearer [missing]\";\n  }\n  return `Bearer ${token}`;\n}\n\n// Register the function with Office.\nOffice.actions.associate(\"addTeamsLinkToLocation\", addTeamsLinkToLocation);\n"],"names":["e","t","r","Symbol","n","iterator","o","toStringTag","i","c","prototype","Generator","u","Object","create","_regeneratorDefine2","f","p","y","G","v","a","d","bind","length","l","TypeError","call","done","value","return","GeneratorFunction","GeneratorFunctionPrototype","getPrototypeOf","setPrototypeOf","__proto__","displayName","_regenerator","w","m","defineProperty","_invoke","enumerable","configurable","writable","asyncGeneratorStep","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","Office","onReady","BUILD_TAG","NOTIFICATION_ICON_ID","DIALOG_URL","getDialogUrl","GRAPH_BASE_URL","GRAPH_SCOPES","AUTH_DIALOG_URL","cachedGraphToken","cachedGraphTokenExpiresAt","GRAPH_TOKEN_STORAGE_KEY","notifySuccess","item","notificationMessages","replaceAsync","type","MailboxEnums","ItemNotificationMessageType","InformationalMessage","icon","persistent","message","concat","notifyError","ErrorMessage","notifyInfo","openCreateEventDialog","teamsLink","baseSubject","subject","prependBuildTag","context","ui","displayDialogAsync","height","width","displayInIframe","result","status","AsyncResultStatus","Succeeded","dialog","addEventHandler","EventType","DialogMessageReceived","arg","data","JSON","parse","parseError","close","action","start","Date","end","Number","isNaN","valueOf","subjectWithTag","mailbox","displayNewAppointmentForm","location","DialogEventReceived","messageChild","stringify","prefix","startsWith","trim","findCalendarEventByGraph","_x","_x2","_findCalendarEventByGraph","_callee2","meetingId","token","url","response","text","items","_context2","getGraphAccessToken","getTime","GRAPH_SEARCH_DAYS","encodeURIComponent","toISOString","logDebug","method","headers","Authorization","exposeAuthHeader","Prefer","fetch","logGraphResponse","ok","Error","json","count","sample","slice","map","summarizeGraphItem","eventMatchesTeams","id","updateCalendarEventLocationGraph","_x3","_x4","_updateCalendarEventLocationGraph","_callee3","eventId","body","_context3","_getGraphAccessToken","_callee4","stored","_token","_context4","now","readStoredGraphToken","expiresAt","OfficeRuntime","auth","getAccessToken","allowSignInPrompt","allowConsentPrompt","forMSGraphAccess","cacheGraphToken","getGraphAccessTokenViaDialog","storeGraphToken","event","bodyText","normalizeText","content","onlineUrl","onlineMeetingUrl","locationText","normalizedMeetingId","normalizedTeamsLink","includes","minutes","parts","split","payload","atob","replace","exp","error","decodeJwtExpiresAt","localStorage","setItem","raw","getItem","parsed","removeItem","reject","code","accessToken","clientId","authority","scopes","level","decodeLink","cleaned","test","decodeURIComponent","decodeHtmlEntities","String","toLowerCase","dateTime","hasMeetingId","Boolean","hasTeamsLink","extractSafeLinkTarget","safeLinkUrl","target","URL","searchParams","get","path","baseUrl","window","origin","console","log","_x5","_x6","_logGraphResponse","_callee5","label","_t3","_context5","clone","actions","associate","itemId","itemType","getAsync","CoercionType","Html","bodyResult","completed","bodyHtml","teamsRegex","safeLinksRegex","akaTeamsRegex","directLink","candidates","rawMatches","match","push","_toConsumableArray","decodedMatches","findTeamsLinkInText","urls","cleanedUrl","extracted","decoded","extractTeamsLink","found","linkMatch","combined","encodedMatch","extractMeetingId","_callee","_context"],"ignoreList":[],"sourceRoot":""}