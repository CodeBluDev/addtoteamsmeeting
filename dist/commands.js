/*! For license information please see commands.js.LICENSE.txt */
!function(){function e(e){return function(e){if(Array.isArray(e))return t(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,n){if(e){if("string"==typeof e)return t(e,n);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?t(e,n):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function n(){var e,t,a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",i=a.toStringTag||"@@toStringTag";function c(n,a,o,i){var c=a&&a.prototype instanceof u?a:u,l=Object.create(c.prototype);return r(l,"_invoke",function(n,r,a){var o,i,c,u=0,l=a||[],f=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return o=t,i=0,c=e,d.n=n,s}};function p(n,r){for(i=n,c=r,t=0;!f&&u&&!a&&t<l.length;t++){var a,o=l[t],p=d.p,m=o[2];n>3?(a=m===r)&&(c=o[(i=o[4])?5:(i=3,3)],o[4]=o[5]=e):o[0]<=p&&((a=n<2&&p<o[1])?(i=0,d.v=r,d.n=o[1]):p<m&&(a=n<3||o[0]>r||r>m)&&(o[4]=n,o[5]=r,d.n=m,i=0))}if(a||n>1)return s;throw f=!0,r}return function(a,l,m){if(u>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,m),i=l,c=m;(t=i<2?e:c)||!f;){o||(i?i<3?(i>1&&(d.n=-1),p(i,c)):d.n=c:d.v=c);try{if(u=2,o){if(i||(a="next"),t=o[a]){if(!(t=t.call(o,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,i<2&&(i=0)}else 1===i&&(t=o.return)&&t.call(o),i<2&&(c=TypeError("The iterator does not provide a '"+a+"' method"),i=1);o=e}else if((t=(f=d.n<0)?c:n.call(r,d))!==s)break}catch(t){o=e,i=1,c=t}finally{u=1}}return{value:t,done:f}}}(n,o,i),!0),l}var s={};function u(){}function l(){}function f(){}t=Object.getPrototypeOf;var d=[][o]?t(t([][o]())):(r(t={},o,function(){return this}),t),p=f.prototype=u.prototype=Object.create(d);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,r(e,i,"GeneratorFunction")),e.prototype=Object.create(p),e}return l.prototype=f,r(p,"constructor",f),r(f,"constructor",l),l.displayName="GeneratorFunction",r(f,i,"GeneratorFunction"),r(p),r(p,i,"Generator"),r(p,o,function(){return this}),r(p,"toString",function(){return"[object Generator]"}),(n=function(){return{w:c,m:m}})()}function r(e,t,n,a){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}r=function(e,t,n,a){function i(t,n){r(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!a,configurable:!a,writable:!a}):e[t]=n:(i("next",0),i("throw",1),i("return",2))},r(e,t,n,a)}function a(e,t,n,r,a,o,i){try{var c=e[o](i),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,a)}function o(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function c(e){a(i,r,o,c,s,"next",e)}function s(e){a(i,r,o,c,s,"throw",e)}c(void 0)})}}Office.onReady(function(){});var i="v1.8.22",c="Icon.16x16",s=D("create-event.html"),u="https://graph.microsoft.com/v1.0",l=["https://graph.microsoft.com/Calendars.ReadWrite"],f=D("auth.html"),d=null,p=0,m="addTeamsGraphToken";function g(e){e.notificationMessages.replaceAsync("success",{type:Office.MailboxEnums.ItemNotificationMessageType.InformationalMessage,icon:c,persistent:!1,message:"Teams meeting link added to Location. (".concat(i," | ").concat("2026-01-16T12:33Z",")")})}function v(e,t){e.notificationMessages.replaceAsync("error",{type:Office.MailboxEnums.ItemNotificationMessageType.ErrorMessage,message:t})}function h(e,t){e.notificationMessages.replaceAsync("info",{type:Office.MailboxEnums.ItemNotificationMessageType.InformationalMessage,icon:c,persistent:!1,message:t})}function y(e,t){var n=e.subject||"Teams meeting",r=b(n);Office.context.ui.displayDialogAsync(s,{height:55,width:35,displayInIframe:!0},function(a){if(a.status===Office.AsyncResultStatus.Succeeded){var o=a.value;o.addEventHandler(Office.EventType.DialogMessageReceived,function(r){var a;try{a=JSON.parse(r.message)}catch(t){return v(e,"Invalid response from dialog."),void o.close()}if("cancel"!==a.action){if("create"!==a.action)return v(e,"Unknown dialog response."),void o.close();var i=new Date(a.start),c=new Date(a.end);if(Number.isNaN(i.valueOf())||Number.isNaN(c.valueOf()))return v(e,"Invalid date/time from dialog."),void o.close();var s=b(a.subject||n);Office.context.mailbox.displayNewAppointmentForm({subject:s,location:t,start:i,end:c}),o.close(),g(e)}else o.close()}),o.addEventHandler(Office.EventType.DialogEventReceived,function(){h(e,"Event dialog closed.")}),o.messageChild(JSON.stringify({subject:r,teamsLink:t}))}else v(e,"Unable to open the event dialog.")})}function b(e){var t="[".concat(i,"] ");return e?e.startsWith(t)?e:"".concat(t).concat(e):t.trim()}function w(e,t){return k.apply(this,arguments)}function k(){return(k=o(n().m(function e(t,r){var a,o,i,c,s,l,f,d,p;return n().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,A();case 1:a=e.v,o=new Date,i=new Date(o.getTime()+31536e6),c="".concat(u,"/me/calendarView?startDateTime=").concat(encodeURIComponent(o.toISOString()),"&endDateTime=").concat(encodeURIComponent(i.toISOString()))+"&$select=id,subject,body,location,onlineMeetingUrl,start,end";case 2:if(!c){e.n=11;break}return P("Graph calendarView request",{method:"GET",url:c,headers:{Authorization:B(a),Prefer:'outlook.body-content-type="text"'}}),e.n=3,fetch(c,{headers:{Authorization:"Bearer ".concat(a),Prefer:'outlook.body-content-type="text"'}});case 3:return s=e.v,e.n=4,L("calendarView",s);case 4:if(s.ok){e.n=6;break}return e.n=5,s.text();case 5:throw l=e.v,new Error("Graph calendarView failed: ".concat(s.status," ").concat(l));case 6:return e.n=7,s.json();case 7:f=e.v,P("Graph calendarView items",{count:(d=f.value||[]).length,sample:d.slice(0,5).map(function(e){return U(e,t,r)})}),p=0;case 8:if(!(p<d.length)){e.n=10;break}if(!I(d[p],t,r)){e.n=9;break}return e.a(2,d[p].id);case 9:p+=1,e.n=8;break;case 10:c=f["@odata.nextLink"]||null,e.n=2;break;case 11:return e.a(2,null)}},e)}))).apply(this,arguments)}function O(e,t){return T.apply(this,arguments)}function T(){return(T=o(n().m(function e(t,r){var a,o,i,c;return n().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,A();case 1:return a=e.v,o={location:{displayName:r}},P("Graph update request",{method:"PATCH",url:"".concat(u,"/me/events/").concat(t),headers:{Authorization:B(a),"Content-Type":"application/json"},body:o}),e.n=2,fetch("".concat(u,"/me/events/").concat(t),{method:"PATCH",headers:{Authorization:"Bearer ".concat(a),"Content-Type":"application/json"},body:JSON.stringify(o)});case 2:return i=e.v,e.n=3,L("updateEvent",i);case 3:if(i.ok){e.n=5;break}return e.n=4,i.text();case 4:throw c=e.v,new Error("Graph update failed: ".concat(i.status," ").concat(c));case 5:return e.a(2)}},e)}))).apply(this,arguments)}function A(){return S.apply(this,arguments)}function S(){return(S=o(n().m(function e(){var t,r,a;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!(d&&Date.now()<p)){e.n=1;break}return e.a(2,d);case 1:if(!(t=x())){e.n=2;break}return d=t.token,p=t.expiresAt,P("Graph token loaded from storage"),e.a(2,t.token);case 2:if(!(OfficeRuntime&&OfficeRuntime.auth&&OfficeRuntime.auth.getAccessToken)){e.n=6;break}return e.p=3,e.n=4,OfficeRuntime.auth.getAccessToken({allowSignInPrompt:!0,allowConsentPrompt:!0,forMSGraphAccess:!0});case 4:return r=e.v,P("Graph token acquired (OfficeRuntime)"),E(r,50),e.a(2,r);case 5:e.p=5,P("OfficeRuntime auth failed",{message:e.v.message});case 6:return e.n=7,M();case 7:return a=e.v,P("Graph token acquired (dialog)"),E(a,45),N(a),e.a(2,a)}},e,null,[[3,5]])}))).apply(this,arguments)}function I(e,t,n){var r=R(e.body&&e.body.content?e.body.content:""),a=R(e.onlineMeetingUrl||""),o=R(e.location&&e.location.displayName?e.location.displayName:""),i=R(n||""),c=R(t||"");return!(!i||!(r.includes(i)||a.includes(i)||o.includes(i)))||!(!c||!(r.includes(c)||a.includes(c)||o.includes(c)))}function E(e,t){d=e,p=Date.now()+60*t*1e3}function N(e){var t=function(e){try{var t=e.split(".");if(t.length<2)return null;var n=JSON.parse(atob(t[1].replace(/-/g,"+").replace(/_/g,"/")));return n&&n.exp?1e3*n.exp:null}catch(e){return null}}(e);if(t)try{localStorage.setItem(m,JSON.stringify({token:e,expiresAt:t}))}catch(e){}}function x(){try{var e=localStorage.getItem(m);if(!e)return null;var t=JSON.parse(e);return t&&t.token&&t.expiresAt?Date.now()>=t.expiresAt-6e4?(localStorage.removeItem(m),null):t:null}catch(e){return null}}function M(){return new Promise(function(e,t){Office.context.ui.displayDialogAsync(f,{height:60,width:40,displayInIframe:!1},function(n){if(n.status!==Office.AsyncResultStatus.Succeeded){var r=n.error&&n.error.message?n.error.message:"Unknown dialog error.";return P("Auth dialog open failed",{code:n.error&&n.error.code,message:r}),void t(new Error("Unable to open auth dialog: ".concat(r)))}var a=n.value;a.addEventHandler(Office.EventType.DialogMessageReceived,function(n){var r;try{r=JSON.parse(n.message)}catch(e){return a.close(),void t(new Error("Invalid auth dialog response."))}if("log"!==r.type)if("ready"!==r.type){if("token"===r.type&&r.accessToken)return a.close(),void e(r.accessToken);a.close(),t(new Error(r.message||"Auth failed."))}else a.messageChild(JSON.stringify({clientId:"226fcb0c-fa77-48bb-a20e-70a75ce176fd",authority:"https://login.microsoftonline.com/organizations",scopes:l}));else P("Auth dialog log",{level:r.level,message:r.message,data:r.data||null})}),a.addEventHandler(Office.EventType.DialogEventReceived,function(e){P("Auth dialog event",{error:e&&e.error?e.error:null}),t(new Error("Auth dialog closed."))})})})}function j(e){var t=e.replace(/&amp;/g,"&");if(/%[0-9A-Fa-f]{2}/.test(t))try{return decodeURIComponent(t)}catch(e){return t}return t}function G(e){return e.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'")}function R(e){return e?j(G(String(e))).toLowerCase():""}function U(e,t,n){var r=R(e.body&&e.body.content?e.body.content:""),a=R(e.onlineMeetingUrl||""),o=R(e.location&&e.location.displayName?e.location.displayName:""),i=R(n||""),c=R(t||"");return{id:e.id||null,subject:e.subject||null,start:e.start&&e.start.dateTime?e.start.dateTime:null,onlineMeetingUrl:e.onlineMeetingUrl||null,location:e.location&&e.location.displayName?e.location.displayName:null,hasMeetingId:Boolean(i&&(r.includes(i)||a.includes(i)||o.includes(i))),hasTeamsLink:Boolean(c&&(r.includes(c)||a.includes(c)||o.includes(c)))}}function C(e){try{var t=new URL(e).searchParams.get("url");return t?decodeURIComponent(t):null}catch(e){return null}}function D(e){var t="undefined"!=typeof window&&window.location&&window.location.origin?window.location.origin:"https://salmon-pebble-0aae76c0f.6.azurestaticapps.net";return"".concat(t,"/").concat(e,"?v=").concat("1.8.22")}function P(e,t){t?console.log("[AddTeamsLink] ".concat(e),t):console.log("[AddTeamsLink] ".concat(e))}function L(e,t){return _.apply(this,arguments)}function _(){return(_=o(n().m(function e(t,r){var a,o;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,r.clone().text();case 1:a=e.v,P("Graph response",{label:t,status:r.status,ok:r.ok,url:r.url,text:a}),e.n=3;break;case 2:e.p=2,o=e.v,P("Graph response read failed",{label:t,message:o.message});case 3:return e.a(2)}},e,null,[[0,2]])}))).apply(this,arguments)}function B(e){return e?"Bearer ".concat(e):"Bearer [missing]"}Office.actions.associate("addTeamsLinkToLocation",function(t){var r=Office.context.mailbox.item;P("Command invoked",{itemId:r.itemId,itemType:r.itemType}),r.body.getAsync(Office.CoercionType.Html,function(a){if(P("Body getAsync result",{status:a.status}),a.status!==Office.AsyncResultStatus.Succeeded)return r.notificationMessages.replaceAsync("error",{type:Office.MailboxEnums.ItemNotificationMessageType.ErrorMessage,message:"Unable to read message body."}),void t.completed();var i=a.value,c=function(t){var n=/https:\/\/teams\.microsoft\.com\/l\/meetup-join\/[^\s"<]+/i,r=/https:\/\/[^\/]+\.safelinks\.protection\.outlook\.com\/[^\s"<]+/i,a=/https:\/\/aka\.ms\/[^\s"<]*teams[^\s"<]*/i,o=function(t){var n=[],r=t.match(/https:\/\/teams\.microsoft\.com\/l\/meetup-join\/[^\s"'<>]+/gi);r&&n.push.apply(n,e(r));var a=G(t).match(/https:\/\/teams\.microsoft\.com\/l\/meetup-join\/[^\s"'<>]+/gi);a&&n.push.apply(n,e(a));for(var o=0;o<n.length;o+=1){var i=j(n[o]);if(i)return i}return null}(t);if(o)return o;for(var i=t.match(/https?:\/\/[^\s"'<>]+/gi)||[],c=0;c<i.length;c+=1){var s=i[c].replace(/&amp;/g,"&");if(n.test(s))return j(s);if(r.test(s)){var u=C(s);if(u){var l=j(u);if(n.test(l))return l}}if(a.test(s))return s}return null}(i);if(P("Teams link match",{found:Boolean(c)}),!c)return h(r,"No Microsoft Teams meeting link found in this invite."),void t.completed();var s=function(e,t){if(t){var n=t.match(/19:meeting_[^/?"'\\s<>]+/i);if(n)return n[0]}var r="".concat(e," ").concat(t||""),a=G(j(r)).match(/19:meeting_[^/?"'\\s<>]+/i);if(a)return a[0];var o=r.match(/19%3Ameeting_[^"'\\s<>%]+/i);return o?j(o[0]):null}(i,c);P("Teams meeting id extracted",{meetingId:s}),o(n().m(function e(){var a;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,w(c,s);case 1:if(a=e.v){e.n=2;break}return h(r,"No matching calendar event found. Opening event dialog."),y(r,c),e.a(2);case 2:return e.n=3,O(a,c);case 3:g(r),e.n=5;break;case 4:e.p=4,P("Graph update failed",{message:e.v.message}),v(r,"Unable to update the calendar location via Microsoft Graph.");case 5:return e.p=5,t.completed(),e.f(5);case 6:return e.a(2)}},e,null,[[0,4,5,6]])}))()})})}();
//# sourceMappingURL=commands.js.map