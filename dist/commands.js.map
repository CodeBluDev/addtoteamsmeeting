{"version":3,"file":"commands.js","mappings":"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","sources":["webpack://office-addin-taskpane-js/./src/commands/commands.js"],"sourcesContent":["/*\n * Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.\n * See LICENSE in the project root for license information.\n */\n\n/* global Office, OfficeRuntime */\n\nOffice.onReady(() => {\n  // If needed, Office.js is ready to be called.\n});\n\nconst BUILD_TAG = \"v1.8.2\";\nconst BUILD_MARKER = \"2024-09-18T16:40Z\";\nconst EWS_MESSAGES_NS = \"http://schemas.microsoft.com/exchange/services/2006/messages\";\nconst EWS_TYPES_NS = \"http://schemas.microsoft.com/exchange/services/2006/types\";\nconst DEBUG_LOGS = true;\nconst NOTIFICATION_ICON_ID = \"Icon.16x16\";\nconst DIALOG_URL = \"https://codebludev.github.io/addtoteamsmeeting/create-event.html?v=1.8.2\";\nconst GRAPH_BASE_URL = \"https://graph.microsoft.com/v1.0\";\nconst GRAPH_SEARCH_DAYS = 90;\nconst AAD_CLIENT_ID = \"226fcb0c-fa77-48bb-a20e-70a75ce176fd\";\nconst AAD_AUTHORITY = \"https://login.microsoftonline.com/organizations\";\nconst GRAPH_SCOPES = [\"https://graph.microsoft.com/Calendars.ReadWrite\"];\nconst AUTH_DIALOG_URL = \"https://codebludev.github.io/addtoteamsmeeting/auth.html?v=1.8.2\";\nlet cachedGraphToken = null;\nlet cachedGraphTokenExpiresAt = 0;\n\n/**\n * Shows a notification when the add-in command is executed.\n * @param event {Office.AddinCommands.Event}\n */\nfunction addTeamsLinkToLocation(event) {\n  const item = Office.context.mailbox.item;\n  logDebug(\"Command invoked\", { itemId: item.itemId, itemType: item.itemType });\n\n  // Read the message body as HTML\n  item.body.getAsync(Office.CoercionType.Html, (bodyResult) => {\n    logDebug(\"Body getAsync result\", { status: bodyResult.status });\n    if (bodyResult.status !== Office.AsyncResultStatus.Succeeded) {\n      item.notificationMessages.replaceAsync(\"error\", {\n        type: Office.MailboxEnums.ItemNotificationMessageType.ErrorMessage,\n        message: \"Unable to read message body.\"\n      });\n      event.completed();\n      return;\n    }\n\n    const bodyHtml = bodyResult.value;\n\n    // Extract the Teams meeting link\n    const teamsLink = extractTeamsLink(bodyHtml);\n    logDebug(\"Teams link match\", { found: Boolean(teamsLink) });\n\n    if (!teamsLink) {\n      notifyInfo(item, \"No Microsoft Teams meeting link found in this invite.\");\n      event.completed();\n      return;\n    }\n\n    logDebug(\"Teams link extracted\", { teamsLink });\n    runEwsHealthCheck((ewsOk, ewsMessage) => {\n      if (!ewsOk) {\n        notifyError(item, `EWS health check failed: ${ewsMessage}`);\n        event.completed();\n        return;\n      }\n\n      findCalendarItemByTeamsLink(teamsLink, (findError, calendarItem) => {\n      logDebug(\"Find by link\", { error: Boolean(findError), found: Boolean(calendarItem) });\n      if (findError) {\n        notifyError(item, `EWS error: ${formatEwsError(findError)}`);\n        notifyInfo(item, \"Opening event dialog (calendar search blocked).\");\n        openCreateEventDialog(item, teamsLink);\n        event.completed();\n        return;\n      }\n\n      if (calendarItem) {\n        updateCalendarItemLocation(calendarItem, teamsLink, (updateError) => {\n          if (updateError) {\n            notifyError(item, \"Unable to update the calendar location.\");\n          } else {\n            notifySuccess(item);\n          }\n          event.completed();\n        });\n        return;\n      }\n\n      getMessageTimeRange(item, (timeError, timeRange) => {\n        logDebug(\"Message time range\", { error: Boolean(timeError), hasRange: Boolean(timeRange) });\n        if (timeError || !timeRange) {\n          notifyInfo(item, \"No matching calendar event found.\");\n          event.completed();\n          return;\n        }\n\n        findCalendarItemByTimeRange(timeRange, (timeFindError, timeCalendarItem) => {\n          logDebug(\"Find by time\", {\n            error: Boolean(timeFindError),\n            found: Boolean(timeCalendarItem)\n          });\n          if (timeFindError) {\n            notifyError(item, `EWS error: ${formatEwsError(timeFindError)}`);\n            notifyInfo(item, \"Opening event dialog (calendar search blocked).\");\n            openCreateEventDialog(item, teamsLink);\n            event.completed();\n            return;\n          }\n\n          if (!timeCalendarItem) {\n            notifyInfo(item, \"No matching calendar event found. Opening event dialog.\");\n            openCreateEventDialog(item, teamsLink);\n            event.completed();\n            return;\n          }\n\n          updateCalendarItemLocation(timeCalendarItem, teamsLink, (updateError) => {\n            if (updateError) {\n              notifyError(item, \"Unable to update the calendar location.\");\n            } else {\n              notifySuccess(item);\n            }\n            event.completed();\n          });\n        });\n      });\n      });\n    });\n  });\n}\n\nfunction notifySuccess(item) {\n  item.notificationMessages.replaceAsync(\"success\", {\n    type: Office.MailboxEnums.ItemNotificationMessageType.InformationalMessage,\n    icon: NOTIFICATION_ICON_ID,\n    persistent: false,\n    message: `Teams meeting link added to Location. (${BUILD_TAG} | ${BUILD_MARKER})`\n  });\n}\n\nfunction notifyError(item, message) {\n  item.notificationMessages.replaceAsync(\"error\", {\n    type: Office.MailboxEnums.ItemNotificationMessageType.ErrorMessage,\n    message\n  });\n}\n\nfunction notifyInfo(item, message) {\n  item.notificationMessages.replaceAsync(\"info\", {\n    type: Office.MailboxEnums.ItemNotificationMessageType.InformationalMessage,\n    icon: NOTIFICATION_ICON_ID,\n    persistent: false,\n    message\n  });\n}\n\nfunction getUtcWindowStart() {\n  const now = new Date();\n  now.setDate(now.getDate() - 7);\n  return now.toISOString();\n}\n\nfunction getUtcWindowEnd() {\n  const now = new Date();\n  now.setDate(now.getDate() + 90);\n  return now.toISOString();\n}\n\nfunction openCreateEventDialog(item, teamsLink) {\n  const subject = item.subject || \"Teams meeting\";\n\n  Office.context.ui.displayDialogAsync(\n    DIALOG_URL,\n    { height: 55, width: 35, displayInIframe: true },\n    (result) => {\n      if (result.status !== Office.AsyncResultStatus.Succeeded) {\n        notifyError(item, \"Unable to open the event dialog.\");\n        return;\n      }\n\n      const dialog = result.value;\n      dialog.addEventHandler(Office.EventType.DialogMessageReceived, (arg) => {\n        let data;\n        try {\n          data = JSON.parse(arg.message);\n        } catch (parseError) {\n          notifyError(item, \"Invalid response from dialog.\");\n          dialog.close();\n          return;\n        }\n\n        if (data.action === \"cancel\") {\n          dialog.close();\n          return;\n        }\n\n        if (data.action !== \"create\") {\n          notifyError(item, \"Unknown dialog response.\");\n          dialog.close();\n          return;\n        }\n\n        const start = new Date(data.start);\n        const end = new Date(data.end);\n        if (Number.isNaN(start.valueOf()) || Number.isNaN(end.valueOf())) {\n          notifyError(item, \"Invalid date/time from dialog.\");\n          dialog.close();\n          return;\n        }\n\n        Office.context.mailbox.displayNewAppointmentForm({\n          subject: data.subject || subject,\n          location: teamsLink,\n          start,\n          end\n        });\n\n        dialog.close();\n        notifySuccess(item);\n      });\n\n      dialog.addEventHandler(Office.EventType.DialogEventReceived, () => {\n        notifyInfo(item, \"Event dialog closed.\");\n      });\n\n      dialog.messageChild(\n        JSON.stringify({\n          subject,\n          teamsLink\n        })\n      );\n    }\n  );\n}\n\nfunction getMessageTimeRange(item, callback) {\n  if (!item.start || !item.end || !item.start.getAsync || !item.end.getAsync) {\n    callback(null, null);\n    return;\n  }\n\n  item.start.getAsync((startResult) => {\n    if (startResult.status !== Office.AsyncResultStatus.Succeeded) {\n      callback(startResult.error, null);\n      return;\n    }\n\n    item.end.getAsync((endResult) => {\n      if (endResult.status !== Office.AsyncResultStatus.Succeeded) {\n        callback(endResult.error, null);\n        return;\n      }\n\n      const start = new Date(startResult.value);\n      const end = new Date(endResult.value);\n      if (Number.isNaN(start.valueOf()) || Number.isNaN(end.valueOf())) {\n        callback(null, null);\n        return;\n      }\n\n      callback(null, { start, end });\n    });\n  });\n}\n\nfunction findCalendarItemByTeamsLink(teamsLink, callback) {\n  const escapedLink = escapeXml(teamsLink);\n  logDebug(\"EWS FindItem by link request prepared\");\n  const request = `<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<soap:Envelope xmlns:soap=\"http://schemas.xmlsoap.org/soap/envelope/\"\n               xmlns:t=\"${EWS_TYPES_NS}\"\n               xmlns:m=\"${EWS_MESSAGES_NS}\">\n  <soap:Header>\n    <t:RequestServerVersion Version=\"Exchange2013\" />\n  </soap:Header>\n  <soap:Body>\n    <m:FindItem Traversal=\"Shallow\">\n      <m:ItemShape>\n        <t:BaseShape>IdOnly</t:BaseShape>\n      </m:ItemShape>\n      <m:CalendarView StartDate=\"${getUtcWindowStart()}\" EndDate=\"${getUtcWindowEnd()}\" />\n      <m:Restriction>\n        <t:Contains ContainmentMode=\"Substring\" ContainmentComparison=\"IgnoreCase\">\n          <t:FieldURI FieldURI=\"item:Body\" />\n          <t:Constant Value=\"${escapedLink}\" />\n        </t:Contains>\n      </m:Restriction>\n      <m:ParentFolderIds>\n        <t:DistinguishedFolderId Id=\"calendar\" />\n      </m:ParentFolderIds>\n    </m:FindItem>\n  </soap:Body>\n</soap:Envelope>`;\n\n  Office.context.mailbox.makeEwsRequestAsync(request, (result) => {\n    logDebug(\"EWS FindItem by link response\", {\n      status: result.status,\n      error: result.error ? { name: result.error.name, message: result.error.message } : null\n    });\n    if (result.status !== Office.AsyncResultStatus.Succeeded) {\n      callback(result.error, null);\n      return;\n    }\n\n    const calendarItem = parseFirstCalendarItem(result.value);\n    callback(null, calendarItem);\n  });\n}\n\nfunction runEwsHealthCheck(callback) {\n  const request = `<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<soap:Envelope xmlns:soap=\"http://schemas.xmlsoap.org/soap/envelope/\"\n               xmlns:t=\"${EWS_TYPES_NS}\"\n               xmlns:m=\"${EWS_MESSAGES_NS}\">\n  <soap:Header>\n    <t:RequestServerVersion Version=\"Exchange2013\" />\n  </soap:Header>\n  <soap:Body>\n    <m:GetFolder>\n      <m:FolderShape>\n        <t:BaseShape>IdOnly</t:BaseShape>\n      </m:FolderShape>\n      <m:FolderIds>\n        <t:DistinguishedFolderId Id=\"calendar\" />\n      </m:FolderIds>\n    </m:GetFolder>\n  </soap:Body>\n</soap:Envelope>`;\n\n  Office.context.mailbox.makeEwsRequestAsync(request, (result) => {\n    logDebug(\"EWS health check response\", {\n      status: result.status,\n      error: result.error ? { name: result.error.name, message: result.error.message } : null\n    });\n\n    if (result.status !== Office.AsyncResultStatus.Succeeded) {\n      callback(false, formatEwsError(result.error));\n      return;\n    }\n\n    const xmlDoc = parseXml(result.value);\n    if (!xmlDoc || !isEwsResponseSuccess(xmlDoc)) {\n      callback(false, \"EWS GetFolder failed.\");\n      return;\n    }\n\n    callback(true, \"OK\");\n  });\n}\n\nfunction findCalendarItemByTimeRange(timeRange, callback) {\n  const startIso = timeRange.start.toISOString();\n  const endIso = timeRange.end.toISOString();\n  logDebug(\"EWS FindItem by time request prepared\", { startIso, endIso });\n  const request = `<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<soap:Envelope xmlns:soap=\"http://schemas.xmlsoap.org/soap/envelope/\"\n               xmlns:t=\"${EWS_TYPES_NS}\"\n               xmlns:m=\"${EWS_MESSAGES_NS}\">\n  <soap:Header>\n    <t:RequestServerVersion Version=\"Exchange2013\" />\n  </soap:Header>\n  <soap:Body>\n    <m:FindItem Traversal=\"Shallow\">\n      <m:ItemShape>\n        <t:BaseShape>IdOnly</t:BaseShape>\n        <t:AdditionalProperties>\n          <t:FieldURI FieldURI=\"calendar:Start\" />\n          <t:FieldURI FieldURI=\"calendar:End\" />\n        </t:AdditionalProperties>\n      </m:ItemShape>\n      <m:CalendarView StartDate=\"${startIso}\" EndDate=\"${endIso}\" />\n      <m:ParentFolderIds>\n        <t:DistinguishedFolderId Id=\"calendar\" />\n      </m:ParentFolderIds>\n    </m:FindItem>\n  </soap:Body>\n</soap:Envelope>`;\n\n  Office.context.mailbox.makeEwsRequestAsync(request, (result) => {\n    logDebug(\"EWS FindItem by time response\", {\n      status: result.status,\n      error: result.error ? { name: result.error.name, message: result.error.message } : null\n    });\n    if (result.status !== Office.AsyncResultStatus.Succeeded) {\n      callback(result.error, null);\n      return;\n    }\n\n    const calendarItem = parseCalendarItemByTime(result.value, timeRange);\n    callback(null, calendarItem);\n  });\n}\n\nfunction updateCalendarItemLocation(calendarItem, location, callback) {\n  const escapedLocation = escapeXml(location);\n  logDebug(\"EWS UpdateItem request prepared\", { itemId: calendarItem.id });\n  const request = `<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<soap:Envelope xmlns:soap=\"http://schemas.xmlsoap.org/soap/envelope/\"\n               xmlns:t=\"${EWS_TYPES_NS}\"\n               xmlns:m=\"${EWS_MESSAGES_NS}\">\n  <soap:Header>\n    <t:RequestServerVersion Version=\"Exchange2013\" />\n  </soap:Header>\n  <soap:Body>\n    <m:UpdateItem ConflictResolution=\"AlwaysOverwrite\" SendMeetingInvitationsOrCancellations=\"SendToNone\">\n      <m:ItemChanges>\n        <t:ItemChange>\n          <t:ItemId Id=\"${calendarItem.id}\" ChangeKey=\"${calendarItem.changeKey}\" />\n          <t:Updates>\n            <t:SetItemField>\n              <t:FieldURI FieldURI=\"calendar:Location\" />\n              <t:CalendarItem>\n                <t:Location>${escapedLocation}</t:Location>\n              </t:CalendarItem>\n            </t:SetItemField>\n          </t:Updates>\n        </t:ItemChange>\n      </m:ItemChanges>\n    </m:UpdateItem>\n  </soap:Body>\n</soap:Envelope>`;\n\n  Office.context.mailbox.makeEwsRequestAsync(request, (result) => {\n    logDebug(\"EWS UpdateItem response\", {\n      status: result.status,\n      error: result.error ? { name: result.error.name, message: result.error.message } : null\n    });\n    if (result.status !== Office.AsyncResultStatus.Succeeded) {\n      callback(result.error);\n      return;\n    }\n\n    const xmlDoc = parseXml(result.value);\n    if (!xmlDoc || !isEwsResponseSuccess(xmlDoc)) {\n      callback(new Error(\"EWS UpdateItem failed.\"));\n      return;\n    }\n\n    callback(null);\n  });\n}\n\nfunction parseFirstCalendarItem(responseText) {\n  const xmlDoc = parseXml(responseText);\n  if (!xmlDoc) {\n    return null;\n  }\n\n  const itemId = xmlDoc.getElementsByTagNameNS(EWS_TYPES_NS, \"ItemId\")[0];\n  if (!itemId) {\n    return null;\n  }\n\n  return {\n    id: itemId.getAttribute(\"Id\"),\n    changeKey: itemId.getAttribute(\"ChangeKey\")\n  };\n}\n\nfunction parseCalendarItemByTime(responseText, timeRange) {\n  const xmlDoc = parseXml(responseText);\n  if (!xmlDoc) {\n    return null;\n  }\n\n  const calendarItems = xmlDoc.getElementsByTagNameNS(EWS_TYPES_NS, \"CalendarItem\");\n  for (let i = 0; i < calendarItems.length; i += 1) {\n    const calendarItem = calendarItems[i];\n    const startNode = calendarItem.getElementsByTagNameNS(EWS_TYPES_NS, \"Start\")[0];\n    const endNode = calendarItem.getElementsByTagNameNS(EWS_TYPES_NS, \"End\")[0];\n    const itemId = calendarItem.getElementsByTagNameNS(EWS_TYPES_NS, \"ItemId\")[0];\n\n    if (!startNode || !endNode || !itemId) {\n      continue;\n    }\n\n    const start = new Date(startNode.textContent);\n    const end = new Date(endNode.textContent);\n    if (Number.isNaN(start.valueOf()) || Number.isNaN(end.valueOf())) {\n      continue;\n    }\n\n    if (isSameTimeRange(start, end, timeRange)) {\n      return {\n        id: itemId.getAttribute(\"Id\"),\n        changeKey: itemId.getAttribute(\"ChangeKey\")\n      };\n    }\n  }\n\n  return null;\n}\n\nfunction isSameTimeRange(start, end, timeRange) {\n  const toleranceMs = 60000;\n  return (\n    Math.abs(start - timeRange.start) <= toleranceMs &&\n    Math.abs(end - timeRange.end) <= toleranceMs\n  );\n}\n\nfunction parseXml(xmlString) {\n  if (!xmlString) {\n    return null;\n  }\n\n  return new DOMParser().parseFromString(xmlString, \"text/xml\");\n}\n\nfunction isEwsResponseSuccess(xmlDoc) {\n  const responseCode = xmlDoc.getElementsByTagNameNS(EWS_MESSAGES_NS, \"ResponseCode\")[0];\n  return responseCode && responseCode.textContent === \"NoError\";\n}\n\nfunction escapeXml(value) {\n  return String(value)\n    .replace(/&/g, \"&amp;\")\n    .replace(/</g, \"&lt;\")\n    .replace(/>/g, \"&gt;\")\n    .replace(/\"/g, \"&quot;\")\n    .replace(/'/g, \"&apos;\");\n}\n\nfunction extractMeetingId(bodyHtml, teamsLink) {\n  if (teamsLink) {\n    const linkMatch = teamsLink.match(/19:meeting_[^/?\"'\\\\s<>]+/i);\n    if (linkMatch) {\n      return linkMatch[0];\n    }\n  }\n\n  const combined = `${bodyHtml} ${teamsLink || \"\"}`;\n  const decoded = decodeHtmlEntities(decodeLink(combined));\n  const match = decoded.match(/19:meeting_[^/?\"'\\\\s<>]+/i);\n  if (match) {\n    return match[0];\n  }\n\n  const encodedMatch = combined.match(/19%3Ameeting_[^\"'\\\\s<>%]+/i);\n  if (encodedMatch) {\n    return decodeLink(encodedMatch[0]);\n  }\n\n  return null;\n}\n\nasync function findCalendarEventByGraph(teamsLink, meetingId) {\n  const token = await getGraphAccessToken();\n  const start = new Date();\n  const end = new Date(start.getTime() + GRAPH_SEARCH_DAYS * 24 * 60 * 60 * 1000);\n  let url = `${GRAPH_BASE_URL}/me/calendarView?startDateTime=${encodeURIComponent(\n    start.toISOString()\n  )}&endDateTime=${encodeURIComponent(end.toISOString())}` +\n    \"&$select=id,subject,body,location,onlineMeetingUrl,start,end\";\n\n  while (url) {\n    const response = await fetch(url, {\n      headers: {\n        Authorization: `Bearer ${token}`,\n        Prefer: 'outlook.body-content-type=\"text\"'\n      }\n    });\n\n    if (!response.ok) {\n      const text = await response.text();\n      throw new Error(`Graph calendarView failed: ${response.status} ${text}`);\n    }\n\n    const data = await response.json();\n    const items = data.value || [];\n\n    for (let i = 0; i < items.length; i += 1) {\n      if (eventMatchesTeams(items[i], teamsLink, meetingId)) {\n        return items[i].id;\n      }\n    }\n\n    url = data[\"@odata.nextLink\"] || null;\n  }\n\n  return null;\n}\n\nasync function updateCalendarEventLocationGraph(eventId, teamsLink) {\n  const token = await getGraphAccessToken();\n  const response = await fetch(`${GRAPH_BASE_URL}/me/events/${eventId}`, {\n    method: \"PATCH\",\n    headers: {\n      Authorization: `Bearer ${token}`,\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify({\n      location: {\n        displayName: teamsLink\n      }\n    })\n  });\n\n  if (!response.ok) {\n    const text = await response.text();\n    throw new Error(`Graph update failed: ${response.status} ${text}`);\n  }\n}\n\nasync function getGraphAccessToken() {\n  if (cachedGraphToken && Date.now() < cachedGraphTokenExpiresAt) {\n    return cachedGraphToken;\n  }\n\n  if (OfficeRuntime && OfficeRuntime.auth && OfficeRuntime.auth.getAccessToken) {\n    try {\n      const token = await OfficeRuntime.auth.getAccessToken({\n        allowSignInPrompt: true,\n        allowConsentPrompt: true,\n        forMSGraphAccess: true\n      });\n      logDebug(\"Graph token acquired (OfficeRuntime)\");\n      cacheGraphToken(token, 50);\n      return token;\n    } catch (error) {\n      logDebug(\"OfficeRuntime auth failed\", { message: error.message });\n    }\n  }\n\n  const token = await getGraphAccessTokenViaDialog();\n  logDebug(\"Graph token acquired (dialog)\");\n  cacheGraphToken(token, 45);\n  return token;\n}\n\nfunction eventMatchesTeams(event, teamsLink, meetingId) {\n  const bodyText = event.body && event.body.content ? event.body.content : \"\";\n  const onlineUrl = event.onlineMeetingUrl || \"\";\n\n  if (meetingId) {\n    if (bodyText.includes(meetingId) || onlineUrl.includes(meetingId)) {\n      return true;\n    }\n  }\n\n  if (teamsLink) {\n    if (bodyText.includes(teamsLink) || onlineUrl.includes(teamsLink)) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nfunction cacheGraphToken(token, minutes) {\n  cachedGraphToken = token;\n  cachedGraphTokenExpiresAt = Date.now() + minutes * 60 * 1000;\n}\n\nfunction getGraphAccessTokenViaDialog() {\n  return new Promise((resolve, reject) => {\n    Office.context.ui.displayDialogAsync(\n      AUTH_DIALOG_URL,\n      { height: 60, width: 40, displayInIframe: true },\n      (result) => {\n        if (result.status !== Office.AsyncResultStatus.Succeeded) {\n          const message = result.error && result.error.message ? result.error.message : \"Unknown dialog error.\";\n          logDebug(\"Auth dialog open failed\", { code: result.error && result.error.code, message });\n          reject(new Error(`Unable to open auth dialog: ${message}`));\n          return;\n        }\n\n        const dialog = result.value;\n        dialog.addEventHandler(Office.EventType.DialogMessageReceived, (arg) => {\n          let data;\n          try {\n            data = JSON.parse(arg.message);\n          } catch (parseError) {\n            dialog.close();\n            reject(new Error(\"Invalid auth dialog response.\"));\n            return;\n          }\n\n          if (data.type === \"ready\") {\n            dialog.messageChild(\n              JSON.stringify({\n                clientId: AAD_CLIENT_ID,\n                authority: AAD_AUTHORITY,\n                scopes: GRAPH_SCOPES\n              })\n            );\n            return;\n          }\n\n          if (data.type === \"token\" && data.accessToken) {\n            dialog.close();\n            resolve(data.accessToken);\n            return;\n          }\n\n          dialog.close();\n          reject(new Error(data.message || \"Auth failed.\"));\n        });\n\n        dialog.addEventHandler(Office.EventType.DialogEventReceived, () => {\n          reject(new Error(\"Auth dialog closed.\"));\n        });\n      }\n    );\n  });\n}\n\nfunction extractTeamsLink(bodyHtml) {\n  const teamsRegex = /https:\\/\\/teams\\.microsoft\\.com\\/l\\/meetup-join\\/[^\\s\"<]+/i;\n  const safeLinksRegex = /https:\\/\\/[^\\/]+\\.safelinks\\.protection\\.outlook\\.com\\/[^\\s\"<]+/i;\n  const akaTeamsRegex = /https:\\/\\/aka\\.ms\\/[^\\s\"<]*teams[^\\s\"<]*/i;\n  const directLink = findTeamsLinkInText(bodyHtml);\n  if (directLink) {\n    return directLink;\n  }\n\n  const urls = bodyHtml.match(/https?:\\/\\/[^\\s\"'<>]+/gi) || [];\n  for (let i = 0; i < urls.length; i += 1) {\n    const rawUrl = urls[i];\n    const cleanedUrl = rawUrl.replace(/&amp;/g, \"&\");\n\n    if (teamsRegex.test(cleanedUrl)) {\n      return decodeLink(cleanedUrl);\n    }\n\n    if (safeLinksRegex.test(cleanedUrl)) {\n      const extracted = extractSafeLinkTarget(cleanedUrl);\n      if (extracted) {\n        const decoded = decodeLink(extracted);\n        if (teamsRegex.test(decoded)) {\n          return decoded;\n        }\n      }\n    }\n\n    if (akaTeamsRegex.test(cleanedUrl)) {\n      return cleanedUrl;\n    }\n  }\n\n  return null;\n}\n\nfunction findTeamsLinkInText(text) {\n  const candidates = [];\n  const rawMatches = text.match(/https:\\/\\/teams\\.microsoft\\.com\\/l\\/meetup-join\\/[^\\s\"'<>]+/gi);\n  if (rawMatches) {\n    candidates.push(...rawMatches);\n  }\n\n  const decodedHtml = decodeHtmlEntities(text);\n  const decodedMatches = decodedHtml.match(/https:\\/\\/teams\\.microsoft\\.com\\/l\\/meetup-join\\/[^\\s\"'<>]+/gi);\n  if (decodedMatches) {\n    candidates.push(...decodedMatches);\n  }\n\n  for (let i = 0; i < candidates.length; i += 1) {\n    const cleaned = decodeLink(candidates[i]);\n    if (cleaned) {\n      return cleaned;\n    }\n  }\n\n  return null;\n}\n\nfunction decodeLink(url) {\n  const cleaned = url.replace(/&amp;/g, \"&\");\n  if (/%[0-9A-Fa-f]{2}/.test(cleaned)) {\n    try {\n      return decodeURIComponent(cleaned);\n    } catch (error) {\n      return cleaned;\n    }\n  }\n  return cleaned;\n}\n\nfunction decodeHtmlEntities(text) {\n  return text\n    .replace(/&amp;/g, \"&\")\n    .replace(/&lt;/g, \"<\")\n    .replace(/&gt;/g, \">\")\n    .replace(/&quot;/g, \"\\\"\")\n    .replace(/&#39;/g, \"'\");\n}\n\nfunction extractSafeLinkTarget(safeLinkUrl) {\n  try {\n    const url = new URL(safeLinkUrl);\n    const target = url.searchParams.get(\"url\");\n    if (!target) {\n      return null;\n    }\n    return decodeURIComponent(target);\n  } catch (error) {\n    return null;\n  }\n}\n\nfunction formatEwsError(error) {\n  if (!error) {\n    return \"Unknown error\";\n  }\n\n  const name = error.name || \"EWS error\";\n  const message = error.message || \"No message\";\n  return `${name}: ${message}`;\n}\n\nfunction logDebug(message, data) {\n  if (!DEBUG_LOGS) {\n    return;\n  }\n\n  if (data) {\n    // eslint-disable-next-line no-console\n    console.log(`[AddTeamsLink] ${message}`, data);\n  } else {\n    // eslint-disable-next-line no-console\n    console.log(`[AddTeamsLink] ${message}`);\n  }\n}\n\n// Register the function with Office.\nOffice.actions.associate(\"addTeamsLinkToLocation\", addTeamsLinkToLocation);\n"],"names":["_toConsumableArray","r","Array","isArray","_arrayLikeToArray","_arrayWithoutHoles","Symbol","iterator","from","_iterableToArray","a","t","toString","call","slice","constructor","name","test","_unsupportedIterableToArray","TypeError","_nonIterableSpread","length","e","n","Office","onReady","EWS_MESSAGES_NS","EWS_TYPES_NS","NOTIFICATION_ICON_ID","notifySuccess","item","notificationMessages","replaceAsync","type","MailboxEnums","ItemNotificationMessageType","InformationalMessage","icon","persistent","message","concat","notifyError","ErrorMessage","notifyInfo","openCreateEventDialog","teamsLink","subject","context","ui","displayDialogAsync","height","width","displayInIframe","result","status","AsyncResultStatus","Succeeded","dialog","value","addEventHandler","EventType","DialogMessageReceived","arg","data","JSON","parse","parseError","close","action","start","Date","end","Number","isNaN","valueOf","mailbox","displayNewAppointmentForm","location","DialogEventReceived","messageChild","stringify","updateCalendarItemLocation","calendarItem","callback","escapedLocation","escapeXml","logDebug","itemId","id","request","changeKey","makeEwsRequestAsync","error","xmlDoc","parseXml","isEwsResponseSuccess","Error","isSameTimeRange","timeRange","Math","abs","xmlString","DOMParser","parseFromString","responseCode","getElementsByTagNameNS","textContent","String","replace","decodeLink","url","cleaned","decodeURIComponent","extractSafeLinkTarget","safeLinkUrl","target","URL","searchParams","get","formatEwsError","console","log","actions","associate","event","itemType","body","getAsync","CoercionType","Html","bodyResult","completed","bodyHtml","teamsRegex","safeLinksRegex","akaTeamsRegex","directLink","text","candidates","rawMatches","match","push","apply","decodedMatches","decodeHtmlEntities","i","findTeamsLinkInText","urls","cleanedUrl","extracted","decoded","extractTeamsLink","found","Boolean","ewsOk","ewsMessage","escapedLink","now","setDate","getDate","toISOString","getUtcWindowEnd","responseText","getAttribute","parseFirstCalendarItem","findCalendarItemByTeamsLink","findError","updateError","startResult","endResult","getMessageTimeRange","timeError","hasRange","startIso","endIso","calendarItems","startNode","endNode","parseCalendarItemByTime","findCalendarItemByTimeRange","timeFindError","timeCalendarItem"],"ignoreList":[],"sourceRoot":""}