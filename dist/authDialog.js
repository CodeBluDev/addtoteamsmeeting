/*! For license information please see authDialog.js.LICENSE.txt */
!function(){function e(n){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(n)}function n(){var e,r,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.toStringTag||"@@toStringTag";function c(n,o,i,a){var c=o&&o.prototype instanceof s?o:s,l=Object.create(c.prototype);return t(l,"_invoke",function(n,t,o){var i,a,c,s=0,l=o||[],f=!1,p={p:0,n:0,v:e,a:d,f:d.bind(e,4),d:function(n,t){return i=n,a=0,c=e,p.n=t,u}};function d(n,t){for(a=n,c=t,r=0;!f&&s&&!o&&r<l.length;r++){var o,i=l[r],d=p.p,g=i[2];n>3?(o=g===t)&&(c=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=e):i[0]<=d&&((o=n<2&&d<i[1])?(a=0,p.v=t,p.n=i[1]):d<g&&(o=n<3||i[0]>t||t>g)&&(i[4]=n,i[5]=t,p.n=g,a=0))}if(o||n>1)return u;throw f=!0,t}return function(o,l,g){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,g),a=l,c=g;(r=a<2?e:c)||!f;){i||(a?a<3?(a>1&&(p.n=-1),d(a,c)):p.n=c:p.v=c);try{if(s=2,i){if(a||(o="next"),r=i[o]){if(!(r=r.call(i,c)))throw TypeError("iterator result is not an object");if(!r.done)return r;c=r.value,a<2&&(a=0)}else 1===a&&(r=i.return)&&r.call(i),a<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),a=1);i=e}else if((r=(f=p.n<0)?c:n.call(t,p))!==u)break}catch(n){i=e,a=1,c=n}finally{s=1}}return{value:r,done:f}}}(n,i,a),!0),l}var u={};function s(){}function l(){}function f(){}r=Object.getPrototypeOf;var p=[][i]?r(r([][i]())):(t(r={},i,function(){return this}),r),d=f.prototype=s.prototype=Object.create(p);function g(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,t(e,a,"GeneratorFunction")),e.prototype=Object.create(d),e}return l.prototype=f,t(d,"constructor",f),t(f,"constructor",l),l.displayName="GeneratorFunction",t(f,a,"GeneratorFunction"),t(d),t(d,a,"Generator"),t(d,i,function(){return this}),t(d,"toString",function(){return"[object Generator]"}),(n=function(){return{w:c,m:g}})()}function t(e,n,r,o){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}t=function(e,n,r,o){function a(n,r){t(e,n,function(e){return this._invoke(n,r,e)})}n?i?i(e,n,{value:r,enumerable:!o,configurable:!o,writable:!o}):e[n]=r:(a("next",0),a("throw",1),a("return",2))},t(e,n,r,o)}function r(e,n,t,r,o,i,a){try{var c=e[i](a),u=c.value}catch(e){return void t(e)}c.done?n(u):Promise.resolve(u).then(r,o)}function o(e){return function(){var n=this,t=arguments;return new Promise(function(o,i){var a=e.apply(n,t);function c(e){r(a,o,i,c,u,"next",e)}function u(e){r(a,o,i,c,u,"throw",e)}c(void 0)})}}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function a(n,t,r){return(t=function(n){var t=function(n){if("object"!=e(n)||!n)return n;var t=n[Symbol.toPrimitive];if(void 0!==t){var r=t.call(n,"string");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(n);return"symbol"==e(t)?t:t+""}(t))in n?Object.defineProperty(n,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[t]=r,n}var c="addTeamsAuthConfig",u=!1,s=null;function l(e,n){Office.context.ui.messageParent(JSON.stringify(function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach(function(n){a(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}({type:e},n)))}function f(e,n,t){l("log",{level:e,message:n,data:t})}function p(e){var n=document.getElementById("authStatus");n&&(n.textContent=e)}function d(e){try{return JSON.parse(e)}catch(e){return null}}function g(e){try{localStorage.setItem(c,JSON.stringify(e))}catch(e){}}function y(){return(y=o(n().m(function e(t){var r,o,i,a,c,s,d,g;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t&&t.clientId){e.n=1;break}return e.a(2);case 1:if(!u){e.n=2;break}return f("info","Auth already in progress, skipping"),e.a(2);case 2:return u=!0,p("Starting sign-inâ€¦"),f("info","Auth config received",{clientId:t.clientId,authority:t.authority,scopes:t.scopes}),r=m(t),o=t.scopes||["https://graph.microsoft.com/Calendars.ReadWrite"],e.p=3,f("info","Starting loginPopup"),e.n=4,r.loginPopup({scopes:o,prompt:"login"});case 4:return i=e.v,f("info","loginPopup succeeded",{username:(a=i.account)&&a.username?a.username:null}),e.n=5,r.acquireTokenSilent({scopes:o,account:a});case 5:c=e.v,p("Token acquired."),l("token",{accessToken:c.accessToken}),f("info","Token acquired via acquireTokenSilent"),e.n=10;break;case 6:return e.p=6,d=e.v,p("Auth error: ".concat(d.message||"login failed")),f("error","loginPopup failed",{name:d.name,message:d.message,errorCode:d.errorCode}),e.p=7,f("info","Starting acquireTokenPopup fallback"),e.n=8,r.acquireTokenPopup({scopes:o,prompt:"login"});case 8:s=e.v,p("Token acquired."),l("token",{accessToken:s.accessToken}),f("info","Token acquired via acquireTokenPopup"),e.n=10;break;case 9:e.p=9,g=e.v,p("Auth error: ".concat(g.message||"login failed")),l("error",{message:g.message||"Auth failed."}),f("error","acquireTokenPopup failed",{name:g.name,message:g.message,errorCode:g.errorCode});case 10:return e.p=10,u=!1,e.f(10);case 11:return e.a(2)}},e,null,[[7,9],[3,6,10,11]])}))).apply(this,arguments)}function m(e){var n={auth:{clientId:e.clientId,authority:e.authority||"https://login.microsoftonline.com/organizations",redirectUri:window.location.origin+window.location.pathname},cache:{cacheLocation:"localStorage",storeAuthStateInCookie:!0}};return new msal.PublicClientApplication(n)}function h(e){return v.apply(this,arguments)}function v(){return(v=o(n().m(function e(t){var r,o,i,a,c;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:if(r=m(t),o=t.scopes||["https://graph.microsoft.com/Calendars.ReadWrite"],i=r.getAllAccounts()[0]){e.n=1;break}return e.a(2,!1);case 1:return e.p=1,f("info","Account found, acquiring token silently"),e.n=2,r.acquireTokenSilent({scopes:o,account:i});case 2:return a=e.v,p("Token acquired."),l("token",{accessToken:a.accessToken}),f("info","Token acquired via acquireTokenSilent"),e.a(2,!0);case 3:return e.p=3,f("error","Silent token failed",{name:(c=e.v).name,message:c.message,errorCode:c.errorCode}),e.a(2,!1)}},e,null,[[1,3]])}))).apply(this,arguments)}function b(){var e=document.getElementById("authStartButton");e&&(e.style.display="inline-block")}Office.onReady(function(){p("Auth dialog ready"),console.log("[AuthDialog] ready"),f("info","Auth dialog ready",{origin:window.location.origin}),window.addEventListener("error",function(e){f("error","Auth dialog error",{message:e.message,filename:e.filename,lineno:e.lineno,colno:e.colno})}),window.addEventListener("unhandledrejection",function(e){var n=e.reason||{};f("error","Auth dialog unhandled rejection",{message:n.message||String(n)})}),Office.context.ui.addHandlerAsync(Office.EventType.DialogParentMessageReceived,function(){var e=o(n().m(function e(t){var r;return n().w(function(e){for(;;)switch(e.n){case 0:if((r=d(t.message))&&r.clientId){e.n=1;break}return p("Missing auth config."),l("error",{message:"Missing auth configuration."}),f("error","Missing auth configuration."),e.a(2);case 1:return g(r),s=r,e.n=2,h(r);case 2:e.v||(p("Ready to sign in."),b());case 3:return e.a(2)}},e)}));return function(n){return e.apply(this,arguments)}}()),l("ready",{});var e=function(){try{var e=localStorage.getItem(c);return e?JSON.parse(e):null}catch(e){return null}}();e&&e.clientId&&(s=e,h(e).then(function(e){e||(p("Ready to sign in."),b())}));var t=document.getElementById("authStartButton");t&&t.addEventListener("click",function(){f("info","User clicked sign-in button"),b(),function(e){y.apply(this,arguments)}(s)})})}();
//# sourceMappingURL=authDialog.js.map